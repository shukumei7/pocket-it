<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pocket IT — Dashboard</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        /* Normalize form controls for consistent vertical alignment */
        select, input[type="text"], input[type="number"], input[type="password"],
        input[type="date"], input[type="time"], input[type="datetime-local"] {
            height: 36px !important;
            margin: 0 !important;
            padding: 6px 10px !important;
            font-size: 13px !important;
            font-family: inherit;
            background: #0f1923;
            color: #c7d5e0;
            border: 1px solid #2a475e;
            border-radius: 6px;
            outline: none;
            vertical-align: middle;
            line-height: normal !important;
        }
        textarea {
            padding: 6px 10px !important;
            font-size: 13px !important;
            font-family: inherit;
            background: #0f1923;
            color: #c7d5e0;
            border: 1px solid #2a475e;
            border-radius: 6px;
            outline: none;
        }
        select:focus, input[type="text"]:focus, input[type="number"]:focus,
        input[type="password"]:focus, input[type="date"]:focus, input[type="time"]:focus,
        input[type="datetime-local"]:focus, textarea:focus {
            border-color: #66c0f4;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: #0f1923;
            color: #c7d5e0;
            min-height: 100vh;
        }

        /* Nav */
        nav {
            background: #1b2838;
            border-bottom: 1px solid #2a475e;
            padding: 0 24px;
            display: flex;
            align-items: center;
            height: 56px;
        }
        nav .logo {
            font-size: 18px;
            font-weight: 700;
            color: #66c0f4;
            margin-right: 32px;
        }
        nav a {
            color: #8f98a0;
            text-decoration: none;
            padding: 16px 16px;
            font-size: 14px;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        nav a:hover, nav a.active {
            color: #c7d5e0;
            border-bottom-color: #66c0f4;
        }
        nav .spacer { flex: 1; }
        nav .status-badge {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 12px;
            background: #1b5e20;
            color: #a5d6a7;
        }
        nav .client-selector {
            margin-left: 16px;
            margin-right: 16px;
            padding: 6px 10px;
            background: #0f1923;
            border: 1px solid #2a475e;
            border-radius: 6px;
            color: #c7d5e0;
            font-size: 13px;
            cursor: pointer;
        }
        nav .client-selector:focus { border-color: #66c0f4; outline: none; }

        .nav-dropdown { display: inline-block; position: relative; }
        .nav-dropdown-menu a.nav-dropdown-item {
            display: block;
            padding: 8px 16px;
            color: #8f98a0;
            text-decoration: none;
            font-size: 13px;
            white-space: nowrap;
        }
        .nav-dropdown-menu a.nav-dropdown-item:hover {
            background: #2a475e;
            color: #fff;
        }
        .nav-dropdown-menu a.nav-dropdown-item.active {
            color: #66c0f4;
        }

        /* Client management page */
        .client-table { width: 100%; border-collapse: collapse; margin-top: 16px; }
        .client-table th, .client-table td {
            padding: 10px 14px; text-align: left; border-bottom: 1px solid #2a475e;
        }
        .client-table th { color: #8f98a0; font-size: 12px; text-transform: uppercase; }
        .client-table td { font-size: 14px; }
        .client-table tr:hover { background: rgba(102, 192, 244, 0.05); }
        .client-form { background: #1b2838; border: 1px solid #2a475e; border-radius: 8px; padding: 20px; margin-bottom: 24px; }
        .client-form input, .client-form textarea {
            width: 100%; padding: 8px 12px; margin-top: 4px; margin-bottom: 12px;
            background: #0f1923; border: 1px solid #2a475e; border-radius: 6px; color: #c7d5e0; font-size: 14px;
        }
        .client-form label { font-size: 13px; color: #8f98a0; }
        .client-group-header { font-size: 15px; font-weight: 600; color: #66c0f4; margin: 20px 0 12px; padding-bottom: 6px; border-bottom: 1px solid #2a475e; }

        /* Layout */
        .container { max-width: 1200px; margin: 0 auto; padding: 24px; }

        /* Stats cards */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        .stat-card {
            background: #1b2838;
            border: 1px solid #2a475e;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: border-color 0.2s, transform 0.1s;
        }
        .stat-card:hover {
            border-color: #66c0f4;
            transform: translateY(-2px);
        }
        .stat-card .value {
            font-size: 32px;
            font-weight: 700;
            color: #66c0f4;
        }
        .stat-card .label {
            font-size: 13px;
            color: #8f98a0;
            margin-top: 4px;
        }

        /* Device grid */
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #c7d5e0;
        }
        .device-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }
        .device-card {
            background: #1b2838;
            border: 1px solid #2a475e;
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            transition: border-color 0.2s;
        }
        .device-card:hover { border-color: #66c0f4; }
        .device-card .device-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .device-card .hostname {
            font-weight: 600;
            font-size: 15px;
        }
        .device-card .device-id {
            font-size: 11px;
            color: #8f98a0;
            font-family: monospace;
        }
        .status-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            display: inline-block;
        }
        .status-dot.online { background: #66bb6a; }
        .status-dot.offline { background: #ef5350; }
        .device-card .last-seen {
            font-size: 12px;
            color: #8f98a0;
            margin-top: 8px;
        }
        .health-bar {
            height: 4px;
            background: #2a475e;
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }
        .health-bar .fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s;
        }
        .health-bar .fill.good { background: #66bb6a; }
        .health-bar .fill.warning { background: #ffa726; }
        .health-bar .fill.critical { background: #ef5350; }
        .health-bar .fill.unknown { background: #8f98a0; }

        /* Ticket list */
        .ticket-list { list-style: none; }
        .ticket-item {
            background: #1b2838;
            border: 1px solid #2a475e;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .ticket-item .priority {
            width: 4px;
            height: 40px;
            border-radius: 2px;
        }
        .priority.low { background: #66bb6a; }
        .priority.medium { background: #ffa726; }
        .priority.high { background: #ef5350; }
        .priority.critical { background: #d50000; }
        .ticket-item .ticket-info { flex: 1; }
        .ticket-item .ticket-title { font-weight: 600; }
        .ticket-item .ticket-meta { font-size: 12px; color: #8f98a0; margin-top: 4px; }
        .ticket-status {
            font-size: 12px;
            padding: 3px 10px;
            border-radius: 10px;
        }
        .ticket-status.open { background: #1b3a5c; color: #66c0f4; }
        .ticket-status.in_progress { background: #4a3f00; color: #ffd54f; }
        .ticket-status.resolved { background: #1b5e20; color: #a5d6a7; }

        /* Device detail panel */
        .detail-panel {
            display: none;
            background: #1b2838;
            border: 1px solid #2a475e;
            border-radius: 8px;
            padding: 24px;
            margin-top: 16px;
        }
        .detail-panel.active { display: block; }
        .detail-panel .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .detail-panel .close-btn {
            background: none;
            border: 1px solid #2a475e;
            color: #8f98a0;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Chat in dashboard */
        .chat-area {
            background: #0f1923;
            border: 1px solid #2a475e;
            border-radius: 8px;
            height: 300px;
            overflow-y: auto;
            padding: 12px;
            margin-bottom: 12px;
        }
        .chat-area .msg {
            margin-bottom: 8px;
            font-size: 13px;
            line-height: 1.4;
        }
        .chat-area .msg .sender-tag {
            font-weight: 600;
            margin-right: 6px;
        }
        .chat-area .msg .sender-tag.user { color: #66c0f4; }
        .chat-area .msg .sender-tag.ai { color: #ab47bc; }
        .chat-area .msg .sender-tag.it_tech { color: #66bb6a; }
        .chat-input-row {
            display: flex;
            gap: 8px;
        }
        .chat-input-row input {
            flex: 1;
            background: #0f1923;
            border: 1px solid #2a475e;
            color: #c7d5e0;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
        }
        .chat-input-row button {
            background: #66c0f4;
            color: #0f1923;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        /* Diag buttons */
        .diag-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }
        .diag-btn {
            background: #2a475e;
            color: #c7d5e0;
            border: none;
            padding: 6px 14px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        .diag-btn:hover { background: #3d6080; }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 48px;
            color: #8f98a0;
        }

        /* Pages */
        .page { display: none; }
        .page.active { display: block; }

        /* Alerts */
        .alert-list { list-style: none; }
        .alert-item {
            background: #1b2838;
            border: 1px solid #2a475e;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .alert-item .severity-indicator {
            width: 4px;
            height: 40px;
            border-radius: 2px;
            flex-shrink: 0;
        }
        .severity-indicator.critical { background: #d50000; }
        .severity-indicator.warning { background: #ffa726; }
        .alert-item .alert-info { flex: 1; }
        .alert-item .alert-title { font-weight: 600; font-size: 14px; }
        .alert-item .alert-meta { font-size: 12px; color: #8f98a0; margin-top: 4px; }
        .alert-item .alert-actions { display: flex; gap: 6px; }
        .alert-item .alert-actions button {
            background: #2a475e;
            color: #c7d5e0;
            border: none;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .alert-item .alert-actions button:hover { background: #3d6080; }
        .alert-item .alert-actions button.resolve-btn { background: #1b5e20; color: #a5d6a7; }
        .alert-item .alert-actions button.resolve-btn:hover { background: #2e7d32; }

        .alert-section {
            background: #1b2838;
            border: 1px solid #2a475e;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
        }
        .alert-section h3 { font-size: 15px; margin-bottom: 12px; color: #c7d5e0; }

        .threshold-table, .channel-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        .threshold-table th, .channel-table th {
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid #2a475e;
            color: #8f98a0;
            font-weight: 500;
        }
        .threshold-table td, .channel-table td {
            padding: 8px;
            border-bottom: 1px solid #1a2535;
        }
        .toggle-btn {
            background: none;
            border: 1px solid #2a475e;
            color: #8f98a0;
            padding: 3px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .toggle-btn.active { border-color: #66bb6a; color: #66bb6a; }
        .toggle-btn:hover { border-color: #66c0f4; color: #66c0f4; }

        .alert-filter-row {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        .alert-filter-btn {
            background: #1b2838;
            border: 1px solid #2a475e;
            color: #8f98a0;
            padding: 6px 14px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        .alert-filter-btn.active { background: #2a475e; color: #c7d5e0; border-color: #66c0f4; }

        /* File manager checkboxes */
        .file-row-cb { accent-color: #66c0f4; cursor:pointer; width:14px; height:14px; }
        .file-action-toolbar { display:none; }
        .file-action-toolbar.visible { display:flex; }

        /* Collapsible section headers */
        .section-title.collapsible:hover { color: #66c0f4; }

        /* File browser */
        .file-browser {
            background: #0f1923;
            border: 1px solid #2a475e;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
        }
        .file-breadcrumb {
            font-size: 12px;
            color: #8f98a0;
            margin-bottom: 8px;
            font-family: monospace;
        }
        .file-breadcrumb span { cursor: pointer; color: #66c0f4; }
        .file-breadcrumb span:hover { text-decoration: underline; }
        .file-list { list-style: none; max-height: 300px; overflow-y: auto; }
        .file-list li {
            padding: 6px 8px;
            font-size: 13px;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .file-list li:hover { background: #1b2838; }
        .file-list .file-icon { width: 16px; text-align: center; }
        .file-list .file-name { flex: 1; }
        .file-list .file-size { font-size: 11px; color: #8f98a0; }
        .file-viewer {
            background: #0a0f14;
            border: 1px solid #2a475e;
            border-radius: 6px;
            padding: 12px;
            margin-top: 12px;
            max-height: 400px;
            overflow: auto;
        }
        .file-viewer pre {
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
            margin: 0;
            color: #a8b4c0;
        }
        .file-viewer .file-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 12px;
            color: #8f98a0;
        }

        /* Script execution */
        .script-panel { margin-top: 12px; }
        .script-select {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }
        .script-select select, .script-select button {
            background: #0f1923;
            border: 1px solid #2a475e;
            color: #c7d5e0;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 13px;
        }
        .script-select select { flex: 1; }
        .script-select button { cursor: pointer; }
        .script-select button:hover { background: #1b2838; }
        .script-textarea {
            width: 100%;
            background: #0a0f14;
            border: 1px solid #2a475e;
            color: #a8b4c0;
            padding: 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            min-height: 80px;
            resize: vertical;
        }
        .script-output {
            background: #0a0f14;
            border: 1px solid #2a475e;
            border-radius: 6px;
            padding: 12px;
            margin-top: 8px;
            max-height: 400px;
            overflow: auto;
        }
        .script-output pre {
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
            margin: 0;
        }
        .script-output .stdout { color: #a8b4c0; }
        .script-output .stderr { color: #ef5350; }
        .script-output .meta {
            font-size: 11px;
            color: #8f98a0;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #1a2535;
        }
        .script-spinner {
            display: inline-block;
            width: 14px; height: 14px;
            border: 2px solid #2a475e;
            border-top-color: #66c0f4;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 6px;
            vertical-align: middle;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Policy table */
        .policy-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .policy-table th {
            text-align: left; padding: 8px;
            border-bottom: 1px solid #2a475e; color: #8f98a0; font-weight: 500;
        }
        .policy-table td { padding: 8px; border-bottom: 1px solid #1a2535; }

        /* Terminal */
        #terminal-container {
            background: #1e1e1e;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 4px;
        }

        #terminal-status {
            font-size: 0.85em;
            color: #888;
        }

        #terminal-status.connected {
            color: #4caf50;
        }

        #terminal-status.waiting {
            color: #ff9800;
        }

        #terminal-status.error {
            color: #f44336;
        }

        .report-range-btn.active {
            background: #66c0f4 !important;
            color: #1b2838 !important;
            font-weight: 600;
        }

        /* System Tools tabs */
        .sys-tools-tabs {
            display: flex; gap: 0; margin-bottom: 12px; border-bottom: 1px solid #2a475e;
        }
        .sys-tools-tab {
            padding: 8px 16px; cursor: pointer; color: #8f98a0; font-size: 13px;
            border-bottom: 2px solid transparent; transition: all 0.2s; background: none; border-top: none; border-left: none; border-right: none;
        }
        .sys-tools-tab:hover, .sys-tools-tab.active {
            color: #c7d5e0; border-bottom-color: #66c0f4;
        }
        .sys-tools-panel { display: none; }
        .sys-tools-panel.active { display: block; }
        .sys-table {
            width: 100%; border-collapse: collapse; font-size: 13px;
        }
        .sys-table th {
            text-align: left; padding: 8px 10px; color: #8f98a0; border-bottom: 1px solid #2a475e; font-weight: 600; cursor: pointer;
        }
        .sys-table th:hover { color: #66c0f4; }
        .sys-table td {
            padding: 6px 10px; border-bottom: 1px solid rgba(42,71,94,0.3); color: #c7d5e0;
        }
        .sys-table tr:hover td { background: rgba(102,192,244,0.05); }
        .sys-table .cpu-high { color: #ef5350; font-weight: 600; }
        .sys-table .cpu-med { color: #ffa726; font-weight: 600; }
        .svc-btn {
            padding: 2px 8px; font-size: 11px; border-radius: 3px; cursor: pointer; border: 1px solid #2a475e; background: #1b2838; color: #66c0f4; transition: all 0.15s;
        }
        .svc-btn:hover { background: #66c0f4; color: #1b2838; }
        .svc-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .svc-btn.danger { color: #ef5350; border-color: #4a1919; }
        .svc-btn.danger:hover { background: #ef5350; color: #fff; }
        .evt-level-error { color: #ef5350; font-weight: 600; }
        .evt-level-warning { color: #ffa726; font-weight: 600; }
        .evt-level-information { color: #66bb6a; }
        .net-adapters { margin-top: 12px; }
        .net-adapter-card {
            background: #0f1923; border: 1px solid #2a475e; border-radius: 6px; padding: 10px 14px; margin-bottom: 6px; font-size: 12px;
        }
        .net-adapter-card .adapter-name { color: #66c0f4; font-weight: 600; font-size: 13px; }
        .sys-filter-bar {
            display: flex; gap: 8px; align-items: center; margin-bottom: 10px; flex-wrap: wrap;
        }
        .sys-filter-bar select, .sys-filter-bar input {
            background: #0f1923; border: 1px solid #2a475e; color: #c7d5e0; padding: 6px 10px; border-radius: 4px; font-size: 12px;
        }
        .sys-filter-bar .preset-btn {
            padding: 4px 10px; font-size: 11px; border-radius: 3px; cursor: pointer; border: 1px solid #2a475e; background: #1b2838; color: #8f98a0;
        }
        .sys-filter-bar .preset-btn:hover { color: #66c0f4; border-color: #66c0f4; }

        /* Activity History */
        .activity-filter-bar {
            display: flex; gap: 8px; align-items: center; margin-bottom: 12px; flex-wrap: wrap;
        }
        .activity-filter-bar select, .activity-filter-bar input {
            background: #0f1923; border: 1px solid #2a475e; color: #c7d5e0; padding: 6px 10px; border-radius: 4px; font-size: 12px;
        }
        .activity-table {
            width: 100%; border-collapse: collapse; font-size: 13px;
        }
        .activity-table th {
            text-align: left; padding: 8px 10px; color: #8f98a0; border-bottom: 1px solid #2a475e; font-weight: 600;
        }
        .activity-table td {
            padding: 7px 10px; border-bottom: 1px solid rgba(42,71,94,0.3); vertical-align: top;
        }
        .activity-table tr:hover td { background: rgba(102,192,244,0.05); }
        .activity-badge {
            display: inline-block; padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: 600; color: #fff; white-space: nowrap;
        }
        .activity-timestamp {
            white-space: nowrap; font-size: 12px; color: #8f98a0;
        }
        .activity-details {
            font-size: 12px; color: #8f98a0; max-width: 300px; word-break: break-word;
        }

        /* Wishlist */
        .wish-filter-row {
            display: flex; gap: 8px; align-items: center; margin-bottom: 16px; flex-wrap: wrap;
        }
        .wish-filter-row select {
            background: #0f1923; border: 1px solid #2a475e; color: #c7d5e0;
            padding: 6px 10px; border-radius: 4px; font-size: 13px;
        }
        .wish-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .wish-table th {
            text-align: left; padding: 10px 12px; color: #8f98a0;
            border-bottom: 1px solid #2a475e; font-weight: 600;
        }
        .wish-table td { padding: 9px 12px; border-bottom: 1px solid rgba(42,71,94,0.4); vertical-align: top; }
        .wish-table tr:hover td { background: rgba(102,192,244,0.04); }
        .wish-vote {
            font-size: 18px; font-weight: 700; color: #66c0f4; text-align: center;
            min-width: 36px;
        }
        .wish-vote.high { font-size: 22px; color: #4fc3f7; }
        .wish-vote.low { font-size: 14px; color: #8f98a0; font-weight: 500; }
        .wish-cat-badge {
            display: inline-block; padding: 2px 8px; border-radius: 10px;
            font-size: 11px; font-weight: 600; color: #0f1923; white-space: nowrap;
        }
        .wish-status-badge {
            display: inline-block; padding: 2px 8px; border-radius: 10px;
            font-size: 11px; font-weight: 600; white-space: nowrap;
        }
        .wish-need { color: #c7d5e0; font-weight: 500; }
        .wish-request {
            color: #8f98a0; font-size: 12px; max-width: 220px;
            overflow: hidden; text-overflow: ellipsis; white-space: nowrap; cursor: pointer;
        }
        .wish-request:hover { white-space: normal; overflow: visible; }
        .wish-actions { display: flex; gap: 4px; white-space: nowrap; }
        .wish-btn {
            padding: 3px 9px; font-size: 11px; border-radius: 3px; cursor: pointer;
            border: 1px solid #2a475e; background: #1b2838; color: #c7d5e0; transition: all 0.15s;
        }
        .wish-btn:hover { background: #2a475e; }
        .wish-btn.approve { color: #81c784; border-color: #2a4a2a; }
        .wish-btn.approve:hover { background: #2a4a2a; }
        .wish-btn.reject { color: #ef5350; border-color: #4a1919; }
        .wish-btn.reject:hover { background: #4a1919; }
        .wish-btn.implement { color: #4fc3f7; border-color: #1a3a4a; }
        .wish-btn.implement:hover { background: #1a3a4a; }
        .wish-stats-bar {
            display: flex; gap: 16px; margin-bottom: 20px; flex-wrap: wrap;
        }
        .wish-stat {
            background: #1b2838; border: 1px solid #2a475e; border-radius: 8px;
            padding: 14px 20px; flex: 1; min-width: 160px;
        }
        .wish-stat .ws-value { font-size: 24px; font-weight: 700; color: #66c0f4; }
        .wish-stat .ws-label { font-size: 12px; color: #8f98a0; margin-top: 2px; }

        /* Deploy page */
        .deploy-tabs { display: flex; gap: 8px; margin-bottom: 20px; }
        .deploy-tabs .diag-btn.active { background: #1a3a5c; }
        .deploy-form-row { display: flex; gap: 16px; flex-wrap: wrap; }
        .deploy-form-row > .deploy-section { flex: 1; min-width: 280px; }
        .deploy-section { background: #1b2838; border: 1px solid #2a475e; border-radius: 8px; padding: 16px; margin-bottom: 16px; }
        .deploy-section-title { font-size: 14px; font-weight: 600; color: #66c0f4; margin-bottom: 12px; padding-bottom: 6px; border-bottom: 1px solid #2a475e; }
        .deploy-section > label { display: block; font-size: 12px; color: #8f98a0; margin: 12px 0 4px; }
        .deploy-section > label:first-of-type { margin-top: 0; }
        .deploy-radio-group { display: flex; gap: 16px; margin: 8px 0; }
        .deploy-radio-group label { display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px; color: #c7d5e0; }
        .deploy-select { max-width: 100%; padding: 8px; background: #0f1923; border: 1px solid #2a475e; color: #c7d5e0; border-radius: 6px; width: 100%; font-size: 13px; }
        .deploy-textarea { width: 100%; min-height: 100px; background: #0f1923; border: 1px solid #2a475e; color: #c7d5e0; padding: 10px; border-radius: 6px; font-family: 'Consolas', 'Monaco', monospace; font-size: 13px; resize: vertical; }
        .deploy-input-sm { width: 80px; background: #0f1923; border: 1px solid #2a475e; color: #c7d5e0; padding: 6px 10px; border-radius: 6px; font-size: 13px; }
        .deploy-device-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px; max-height: 300px; overflow-y: auto; padding: 4px; }
        .deploy-device-card { background: #0f1923; border: 1px solid #2a475e; border-radius: 8px; padding: 12px; cursor: pointer; transition: border-color 0.2s, background 0.2s; user-select: none; position: relative; }
        .deploy-device-card:hover { border-color: #4a7a9b; }
        .deploy-device-card.selected { border-color: #66c0f4; background: rgba(102,192,244,0.08); }
        .deploy-device-card .dd-hostname { font-weight: 600; font-size: 13px; color: #c7d5e0; margin-bottom: 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .deploy-device-card .dd-status { display: flex; align-items: center; gap: 6px; font-size: 11px; color: #8f98a0; }
        .deploy-device-card .dd-check { position: absolute; top: 8px; right: 8px; width: 16px; height: 16px; border-radius: 4px; border: 1px solid #2a475e; display: flex; align-items: center; justify-content: center; font-size: 11px; color: #66c0f4; }
        .deploy-device-card.selected .dd-check { border-color: #66c0f4; background: rgba(102,192,244,0.15); }
        .deploy-device-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; flex-shrink: 0; }
        .deploy-device-dot.online { background: #4caf50; }
        .deploy-device-dot.offline { background: #616161; }
        .deploy-device-status { font-size: 11px; color: #8f98a0; margin-left: auto; }
        .deploy-btn-row { display: flex; gap: 8px; margin: 6px 0 4px; }
        .deploy-btn-row .diag-btn { font-size: 12px; padding: 4px 12px; }
        .deploy-submit { background: #66c0f4; color: #1b2838; font-weight: 600; padding: 10px 28px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; transition: background 0.2s; }
        .deploy-submit:hover { background: #7fd4ff; }
        .deploy-submit:disabled { opacity: 0.5; cursor: not-allowed; }
        .deploy-file-info { font-size: 12px; color: #8f98a0; margin: 4px 0 8px; }
        .deploy-file-info.error { color: #ef5350; }
        .deploy-history-card { background: #1b2838; border: 1px solid #2a475e; border-radius: 8px; padding: 16px; margin-bottom: 12px; }
        .deploy-history-card .dh-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .deploy-history-card .dh-name { font-weight: 600; color: #c7d5e0; }
        .deploy-history-card .dh-type { font-size: 12px; color: #8f98a0; margin-left: 8px; background: #0f1923; padding: 2px 8px; border-radius: 10px; }
        .deploy-history-card .dh-status { font-size: 12px; font-weight: 600; }
        .deploy-history-card .dh-meta { font-size: 11px; color: #8f98a0; margin-bottom: 8px; }
        .deploy-history-card .dh-count { font-size: 12px; color: #8f98a0; }
        .deploy-cancel-btn { font-size: 11px; padding: 2px 10px; background: rgba(239,83,80,0.15); color: #ef5350; border: 1px solid rgba(239,83,80,0.3); border-radius: 4px; cursor: pointer; }
        .deploy-cancel-btn:hover { background: rgba(239,83,80,0.25); }
        .deploy-result-row { display: flex; gap: 10px; align-items: center; padding: 6px 10px; border-bottom: 1px solid rgba(26,38,53,0.8); font-size: 13px; }
        .deploy-result-row:last-child { border-bottom: none; }
        .deploy-result-host { min-width: 130px; color: #c7d5e0; }
        .deploy-result-status { font-size: 12px; min-width: 65px; font-weight: 500; }
        .deploy-result-meta { font-size: 11px; color: #8f98a0; }
        .deploy-schedule-input { background: #0f1923; border: 1px solid #2a475e; color: #c7d5e0; padding: 6px 10px; border-radius: 6px; font-size: 13px; }
        .deploy-schedule-input:disabled { opacity: 0.4; }
        .deploy-checkbox-box { background: #0f1923; border: 1px solid #2a475e; border-radius: 6px; padding: 8px 12px; margin-top: 10px; }
        .deploy-checkbox-label { display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px; color: #c7d5e0; }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/css/xterm.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
</head>
<body>
    <!-- Login overlay -->
    <div id="login-overlay" style="position:fixed; top:0; left:0; right:0; bottom:0; background:#0f1923; z-index:1000; display:flex; align-items:center; justify-content:center;">
        <div style="background:#1b2838; border:1px solid #2a475e; border-radius:12px; padding:40px; width:400px; text-align:center;">
            <div style="font-size:24px; font-weight:700; color:#66c0f4; margin-bottom:8px;">Pocket IT</div>
            <div id="login-subtitle" style="font-size:13px; color:#8f98a0; margin-bottom:24px;">IT Dashboard Login</div>
            <div id="login-error" style="display:none; background:#4a1919; color:#ef5350; padding:8px 12px; border-radius:6px; font-size:13px; margin-bottom:16px;"></div>

            <!-- Step 1: Password -->
            <div id="login-step-password">
                <input type="text" id="login-username" placeholder="Username" style="width:100%; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:10px 14px; border-radius:6px; font-size:14px; margin-bottom:12px;" />
                <input type="password" id="login-password" placeholder="Password" style="width:100%; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:10px 14px; border-radius:6px; font-size:14px; margin-bottom:16px;" />
                <button id="btn-login" style="width:100%; background:#66c0f4; color:#0f1923; border:none; padding:10px; border-radius:6px; font-size:14px; font-weight:600; cursor:pointer;">Sign In</button>
            </div>

            <!-- Step 2: TOTP verification (existing 2FA) -->
            <div id="login-step-totp" style="display:none;">
                <p style="color:#c7d5e0; font-size:13px; margin-bottom:16px;">Enter the 6-digit code from your authenticator app</p>
                <input type="text" id="login-totp-code" placeholder="000 000" maxlength="7" autocomplete="one-time-code" style="width:180px; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:12px 14px; border-radius:6px; font-size:20px; text-align:center; letter-spacing:4px; margin-bottom:8px;" />
                <p style="color:#8f98a0; font-size:11px; margin-bottom:16px;">Or enter an 8-character backup code</p>
                <button id="btn-verify-totp" style="width:100%; background:#66c0f4; color:#0f1923; border:none; padding:10px; border-radius:6px; font-size:14px; font-weight:600; cursor:pointer;">Verify</button>
                <button id="btn-back-to-login" style="width:100%; background:transparent; color:#8f98a0; border:1px solid #2a475e; padding:8px; border-radius:6px; font-size:13px; cursor:pointer; margin-top:8px;">Back</button>
            </div>

            <!-- Step 3: 2FA Setup (first time) -->
            <div id="login-step-setup" style="display:none;">
                <p style="color:#c7d5e0; font-size:13px; margin-bottom:16px;">Two-factor authentication is required. Scan this QR code with your authenticator app:</p>
                <div id="setup-qr-container" style="margin-bottom:16px;">
                    <img id="setup-qr-image" src="" alt="QR Code" style="width:200px; height:200px; border-radius:8px; background:#fff; padding:8px;" />
                </div>
                <details style="text-align:left; margin-bottom:16px;">
                    <summary style="color:#8f98a0; font-size:12px; cursor:pointer;">Manual entry key</summary>
                    <code id="setup-manual-key" style="display:block; background:#0f1923; color:#66c0f4; padding:8px 12px; border-radius:4px; font-size:13px; word-break:break-all; margin-top:8px;"></code>
                </details>
                <p style="color:#c7d5e0; font-size:13px; margin-bottom:12px;">Enter the code shown in your app to confirm:</p>
                <input type="text" id="setup-totp-code" placeholder="000 000" maxlength="7" autocomplete="one-time-code" style="width:180px; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:12px 14px; border-radius:6px; font-size:20px; text-align:center; letter-spacing:4px; margin-bottom:16px;" />
                <button id="btn-confirm-setup" style="width:100%; background:#66c0f4; color:#0f1923; border:none; padding:10px; border-radius:6px; font-size:14px; font-weight:600; cursor:pointer;">Activate 2FA</button>
            </div>

            <!-- Step 4: Backup codes display (shown after setup) -->
            <div id="login-step-backup" style="display:none;">
                <p style="color:#c7d5e0; font-size:13px; margin-bottom:8px;">Save these backup codes in a safe place. Each code can only be used once.</p>
                <div id="backup-codes-grid" style="display:grid; grid-template-columns:1fr 1fr; gap:6px; margin-bottom:16px; text-align:left;"></div>
                <button id="btn-copy-backup" style="width:100%; background:transparent; color:#8f98a0; border:1px solid #2a475e; padding:8px; border-radius:6px; font-size:13px; cursor:pointer; margin-bottom:8px;">Copy All Codes</button>
                <button id="btn-backup-done" style="width:100%; background:#66c0f4; color:#0f1923; border:none; padding:10px; border-radius:6px; font-size:14px; font-weight:600; cursor:pointer;">I've Saved My Codes</button>
            </div>
        </div>
    </div>

    <nav>
        <span class="logo">Pocket IT</span>
        <select id="client-selector" class="client-selector" style="display:none;">
            <option value="">All Clients</option>
        </select>
        <a href="#" class="nav-link active" data-page="fleet">Fleet</a>
        <a href="#" class="nav-link" data-page="tickets">Tickets</a>

        <a href="#" class="nav-link" data-page="alerts">Alerts <span id="nav-alert-badge" style="display:none; background:#ef5350; color:#fff; font-size:10px; padding:2px 6px; border-radius:8px; margin-left:4px;">0</span></a>
        <a href="#" class="nav-link" data-page="reports">Reports</a>
        <a href="#" class="nav-link" data-page="deploy">Deploy</a>
        <div id="nav-admin-dropdown" class="nav-dropdown" style="display:none; position:relative;">
            <a href="#" class="nav-link" id="nav-admin-toggle">Admin &#9662;</a>
            <div class="nav-dropdown-menu" style="display:none; position:absolute; top:100%; left:0; z-index:100; min-width:160px; background:#1b2838; border:1px solid #2a475e; border-radius:6px; box-shadow:0 4px 12px rgba(0,0,0,0.4); padding:4px 0;">
                <a href="#" class="nav-dropdown-item" data-page="clients">Clients</a>
                <a href="#" class="nav-dropdown-item" data-page="settings">Settings</a>
                <a href="#" class="nav-dropdown-item" data-page="updates">Updates</a>
                <a href="#" class="nav-dropdown-item" data-page="users">Users</a>
                <a href="#" class="nav-dropdown-item" data-page="wishlist">Wishlist</a>
            </div>
        </div>
        <span class="spacer"></span>
        <span class="status-badge" id="server-status">Connected</span>
    </nav>

    <div class="container">
        <!-- Fleet page -->
        <div class="page active" id="page-fleet">
            <div class="stats-row">
                <div class="stat-card" data-page="fleet">
                    <div class="value" id="stat-online">0</div>
                    <div class="label">Devices Online</div>
                </div>
                <div class="stat-card" data-page="fleet">
                    <div class="value" id="stat-total">0</div>
                    <div class="label">Total Devices</div>
                </div>
                <div class="stat-card" data-page="tickets">
                    <div class="value" id="stat-tickets-open">0</div>
                    <div class="label">Open Tickets</div>
                </div>
                <div class="stat-card" data-page="tickets">
                    <div class="value" id="stat-tickets-total">0</div>
                    <div class="label">Total Tickets</div>
                </div>
                <div class="stat-card" data-page="reports">
                    <div class="value" id="stat-health">—</div>
                    <div class="label">Avg Health Score</div>
                </div>
                <div class="stat-card" data-page="alerts">
                    <div class="value" id="stat-critical" style="color: #ef5350;">0</div>
                    <div class="label">Critical Devices</div>
                </div>
                <div class="stat-card" data-page="alerts">
                    <div class="value" id="stat-alerts" style="color: #ef5350;">0</div>
                    <div class="label">Active Alerts</div>
                </div>
            </div>

            <div style="display:flex; align-items:center; gap:12px; margin-bottom:4px;">
                <h2 class="section-title" style="margin-bottom:0;">Devices</h2>
                <button id="fleet-installer-btn" class="diag-btn" style="display:none; font-size:12px; padding:5px 14px;">Download Installer</button>
            </div>
            <div class="device-grid" id="device-grid">
                <div class="empty-state">No devices enrolled yet. Generate an enrollment token to get started.</div>
            </div>

        </div>

        <!-- Device detail page -->
        <div class="page" id="page-device">
          <!-- Back button + device header -->
          <div style="display:flex; align-items:center; gap:12px; margin-bottom:20px;">
            <button class="diag-btn" id="btn-back-to-fleet" style="font-size:18px; padding:4px 12px;">&larr;</button>
            <h2 id="detail-hostname" style="margin:0; color:#c7d5e0;">Device</h2>
            <span id="detail-status-dot" class="status-dot"></span>
            <span id="detail-device-id" style="font-size:12px; color:#8f98a0; font-family:monospace;"></span>
          </div>

          <!-- Device info cards -->
          <div id="detail-info" class="stats-row" style="margin-bottom:20px;"></div>

          <!-- Two-column layout: tools + chat -->
          <div style="display:grid; grid-template-columns:1fr 400px; gap:20px;">
            <!-- Left column: Diagnostics, File Browser, Scripts -->
            <div>
              <h2 class="section-title">Diagnostics</h2>
              <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:16px; margin-bottom:20px;">
                <div class="diag-actions" id="diag-actions" style="margin-bottom:12px;">
                  <button class="diag-btn" data-diag="all">Run All</button>
                  <button class="diag-btn" data-diag="cpu">CPU</button>
                  <button class="diag-btn" data-diag="memory">Memory</button>
                  <button class="diag-btn" data-diag="disk">Disk</button>
                  <button class="diag-btn" data-diag="network">Network</button>
                </div>
                <div id="detail-diagnostics"></div>
              </div>

              <h2 class="section-title" id="sys-tools-heading" style="cursor:pointer; user-select:none;" title="Click to expand/collapse">System Tools <span id="sys-tools-toggle" style="font-size:14px; color:#8f98a0;">&#x25BC;</span></h2>
              <input type="hidden" id="sys-tools-section-loaded" value="" />
              <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:16px; margin-bottom:20px;">
                <div id="sys-tools-content" style="display:none;">
                <div class="sys-tools-tabs">
                  <button class="sys-tools-tab active" data-tab="processes">Processes</button>
                  <button class="sys-tools-tab" data-tab="services">Services</button>
                  <button class="sys-tools-tab" data-tab="eventlog">Event Log</button>
                </div>

                <!-- Processes Panel -->
                <div id="sys-panel-processes" class="sys-tools-panel active">
                  <div class="sys-filter-bar">
                    <button class="diag-btn" id="btn-refresh-processes">Refresh</button>
                    <label style="font-size:12px; color:#8f98a0; display:flex; align-items:center; gap:4px;">
                      <input type="checkbox" id="proc-auto-refresh"> Auto-refresh (10s)
                    </label>
                    <span id="proc-count" style="font-size:12px; color:#8f98a0; margin-left:auto;"></span>
                  </div>
                  <div id="proc-table-container" style="max-height:400px; overflow-y:auto;">
                    <div style="color:#8f98a0; font-size:13px;">Click Refresh to load processes</div>
                  </div>
                </div>

                <!-- Services Panel -->
                <div id="sys-panel-services" class="sys-tools-panel">
                  <div class="sys-filter-bar">
                    <button class="diag-btn" id="btn-refresh-services">Refresh</button>
                    <select id="svc-filter">
                      <option value="">All</option>
                      <option value="running">Running</option>
                      <option value="stopped">Stopped</option>
                    </select>
                    <input type="text" id="svc-search" placeholder="Search services..." style="width:180px;" />
                    <span id="svc-count" style="font-size:12px; color:#8f98a0; margin-left:auto;"></span>
                  </div>
                  <div id="svc-table-container" style="max-height:400px; overflow-y:auto;">
                    <div style="color:#8f98a0; font-size:13px;">Click Refresh to load services</div>
                  </div>
                </div>

                <!-- Event Log Panel -->
                <div id="sys-panel-eventlog" class="sys-tools-panel">
                  <div class="sys-filter-bar">
                    <select id="evt-log-name">
                      <option value="System">System</option>
                      <option value="Application">Application</option>
                      <option value="Security">Security</option>
                    </select>
                    <select id="evt-level">
                      <option value="error">Errors</option>
                      <option value="warning">Warnings</option>
                      <option value="error,warning">Errors + Warnings</option>
                      <option value="information">Information</option>
                    </select>
                    <select id="evt-hours">
                      <option value="24">Last 24h</option>
                      <option value="48">Last 48h</option>
                      <option value="72">Last 3 days</option>
                      <option value="168">Last 7 days</option>
                    </select>
                    <button class="diag-btn" id="btn-query-eventlog">Query</button>
                    <button class="sys-filter-bar preset-btn" id="btn-preset-errors-24h">Errors 24h</button>
                    <button class="sys-filter-bar preset-btn" id="btn-preset-critical-7d">Critical 7d</button>
                    <input type="text" id="evt-search" placeholder="Search ID, source, message..." style="width:200px;" />
                    <span id="evt-count" style="font-size:12px; color:#8f98a0; margin-left:auto;"></span>
                  </div>
                  <div id="evt-table-container" style="max-height:400px; overflow-y:auto;">
                    <div style="color:#8f98a0; font-size:13px;">Select filters and click Query</div>
                  </div>
                </div>
                </div><!-- end sys-tools-content -->
              </div>

              <h2 class="section-title" id="file-browser-heading" style="cursor:pointer; user-select:none;" title="Click to expand/collapse">File Browser <span id="file-section-toggle" style="font-size:14px; color:#8f98a0;">&#x25BC;</span></h2>
              <input type="hidden" id="file-section-loaded" value="" />
              <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:16px; margin-bottom:20px;">
                <div id="file-section-content" style="display:none;">
                <!-- Action toolbar (shown when files are selected) -->
                <div id="file-action-toolbar" style="display:none; background:#0e1621; border:1px solid #2a475e; border-radius:6px; padding:8px 12px; margin-bottom:10px; flex-wrap:wrap; align-items:center; gap:8px;">
                  <span id="file-selection-count" style="font-size:13px; color:#8f98a0; margin-right:4px;">0 items selected</span>
                  <button class="diag-btn" id="file-action-copy" style="font-size:12px; padding:4px 10px;">Copy</button>
                  <button class="diag-btn" id="file-action-cut" style="font-size:12px; padding:4px 10px;">Cut</button>
                  <button id="file-paste-btn" class="diag-btn" style="font-size:12px; padding:4px 10px;" disabled>Paste</button>
                  <button class="diag-btn" id="file-action-delete" style="font-size:12px; padding:4px 10px; background:#4a1919; color:#ef5350;">Delete</button>
                  <button class="diag-btn" id="file-action-copy-paths" style="font-size:12px; padding:4px 10px;">Copy Paths</button>
                  <button class="diag-btn" id="file-properties-btn" style="font-size:12px; padding:4px 10px;">Properties</button>
                  <button class="diag-btn" id="file-action-upload" style="font-size:12px; padding:4px 10px;">Upload</button>
                  <button class="diag-btn" id="file-action-download" style="font-size:12px; padding:4px 10px;">Download</button>
                </div>
                <input type="file" id="file-upload-input" multiple style="display:none;" />
                <!-- Breadcrumb navigation bar -->
                <div id="file-breadcrumb" style="display:flex; align-items:center; gap:4px; margin-bottom:12px; padding:8px 12px; background:#0e1621; border-radius:6px; flex-wrap:wrap; min-height:36px;">
                  <span id="breadcrumb-drives" style="color:#66c0f4; cursor:pointer; font-size:14px;" title="Drives">&#x1F4BB; Drives</span>
                </div>
                <!-- File listing area -->
                <div id="file-browser-area" style="min-height:200px; max-height:500px; overflow-y:auto;"></div>
                <!-- Properties panel -->
                <div id="file-properties-panel" style="display:none; margin-top:12px; background:#0a0f14; border:1px solid #2a475e; border-radius:6px; padding:12px;">
                  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                    <span style="font-size:13px; font-weight:600; color:#c7d5e0;">File Properties</span>
                    <button id="btn-close-file-properties" style="background:#2a475e; color:#c7d5e0; border:none; border-radius:4px; padding:3px 10px; cursor:pointer; font-size:12px;">&#x2715;</button>
                  </div>
                  <div id="file-properties-content" style="font-size:12px; font-family:monospace; color:#a8b4c0; line-height:1.6;"></div>
                </div>
                </div><!-- end file-section-content -->
              </div>

              <h2 class="section-title">Remote Scripts</h2>
              <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:16px; margin-bottom:20px;">
                <div class="script-select" style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
                  <select id="script-library-select" style="flex:1; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px;">
                    <option value="">-- Select from library --</option>
                  </select>
                  <button class="diag-btn" id="btn-run-library-script">Run</button>
                </div>
                <details style="margin-top:8px;">
                  <summary style="cursor:pointer; font-size:13px; color:#8f98a0;">Ad-hoc Script</summary>
                  <div style="margin-top:8px;">
                    <textarea id="adhoc-script" class="script-textarea" placeholder="Enter PowerShell script..." style="width:100%; min-height:80px; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; font-family:monospace; font-size:13px; resize:vertical; box-sizing:border-box;"></textarea>
                    <div style="display:flex; gap:8px; margin-top:8px; align-items:center;">
                      <label style="font-size:12px; color:#8f98a0; display:flex; align-items:center; gap:4px;">
                        <input type="checkbox" id="adhoc-elevation" /> Admin
                      </label>
                      <input type="number" id="adhoc-timeout" value="60" min="5" max="300" style="width:60px; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:4px 6px; border-radius:4px; font-size:12px;" />
                      <span style="font-size:11px; color:#8f98a0;">sec</span>
                      <span style="flex:1;"></span>
                      <button class="diag-btn" id="btn-run-adhoc-script">Execute</button>
                    </div>
                  </div>
                </details>
                <div id="script-output-area" style="margin-top:12px;"></div>
              </div>
            </div>

            <!-- Right column: Live Chat + AI Guidance -->
            <div>
              <div style="display:flex; gap:0; margin-bottom:0;">
                <button class="diag-btn" id="chat-tab-user" data-tab="user" style="border-radius:6px 6px 0 0; background:#1a3a5c; border-bottom:2px solid #66c0f4;">User Chat</button>
                <button class="diag-btn" id="chat-tab-guidance" data-tab="guidance" style="border-radius:6px 6px 0 0; border-bottom:2px solid transparent;">AI Guidance</button>
              </div>
              <!-- User Chat panel -->
              <div id="chat-panel-user" style="background:#1b2838; border:1px solid #2a475e; border-radius:0 8px 8px 8px; padding:16px; display:flex; flex-direction:column; height:480px;">
                <div class="chat-area" id="detail-chat" style="flex:1; overflow-y:auto; margin-bottom:12px;"></div>
                <div style="display:flex; gap:8px;">
                  <input type="text" id="detail-chat-input" placeholder="Send message to user..." style="flex:1; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px 12px; border-radius:4px;" />
                  <button class="diag-btn" id="btn-send-chat" style="background:#66c0f4; color:#1b2838; font-weight:600;">Send</button>
                </div>
              </div>
              <!-- AI Guidance panel -->
              <div id="chat-panel-guidance" style="display:none; background:#1b2838; border:1px solid #2a475e; border-radius:0 8px 8px 8px; padding:16px; flex-direction:column; height:480px;">
                <div class="chat-area" id="guidance-chat" style="flex:1; overflow-y:auto; margin-bottom:12px;"></div>
                <div style="display:flex; gap:8px;">
                  <input type="text" id="guidance-chat-input" placeholder="Instruct AI (e.g., 'check disk space', 'restart spooler')..." style="flex:1; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px 12px; border-radius:4px;" />
                  <button class="diag-btn" id="btn-send-guidance" style="background:#e65100; color:#fff; font-weight:600;">Send</button>
                </div>
                <div style="display:flex; gap:8px; margin-top:6px;">
                  <button class="diag-btn" id="btn-clear-guidance" style="font-size:11px; padding:3px 8px;">Clear Context</button>
                  <span id="guidance-status" style="font-size:11px; color:#8f98a0; align-self:center;"></span>
                </div>
              </div>
            </div>
          </div>

          <!-- Full-width: Remote Desktop -->
          <h2 class="section-title" style="margin-top:20px;">Remote Desktop</h2>
          <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:16px; margin-bottom:20px;">
            <div id="desktop-controls" style="margin-bottom:10px; display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
              <button id="btn-start-desktop" class="diag-btn">Connect</button>
              <button id="btn-stop-desktop" class="diag-btn" disabled style="background:#4a1919; color:#ef5350;">Disconnect</button>
              <button class="diag-btn" id="btn-popout-desktop" title="Open in new tab">&#8599; New Tab</button>
              <span id="desktop-status" style="color:#8f98a0; font-size:13px;">Not connected</span>
              <span style="flex:1;"></span>
              <label style="font-size:12px; color:#8f98a0;">Quality:</label>
              <select id="desktop-quality" style="background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:4px 8px; border-radius:4px; font-size:12px;">
                <option value="30">Low</option>
                <option value="50" selected>Medium</option>
                <option value="75">High</option>
              </select>
              <label style="font-size:12px; color:#8f98a0;">FPS:</label>
              <select id="desktop-fps" style="background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:4px 8px; border-radius:4px; font-size:12px;">
                <option value="5">5</option>
                <option value="10" selected>10</option>
                <option value="15">15</option>
                <option value="24">24</option>
              </select>
              <label style="font-size:12px; color:#8f98a0;">Scale:</label>
              <select id="desktop-scale" style="background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:4px 8px; border-radius:4px; font-size:12px;">
                <option value="0.25">25%</option>
                <option value="0.5" selected>50%</option>
                <option value="0.75">75%</option>
                <option value="1.0">100%</option>
              </select>
            </div>
            <div id="desktop-viewer" style="display:none; position:relative; background:#000; border-radius:4px; overflow:hidden; cursor:crosshair;">
              <canvas id="desktop-canvas" style="width:100%; display:block;"></canvas>
            </div>
          </div>

          <!-- Full-width: Remote Terminal -->
          <h2 class="section-title" style="margin-top:20px;">Remote Terminal</h2>
          <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:16px; margin-bottom:20px;">
            <div id="terminal-controls" style="margin-bottom:10px; display:flex; align-items:center; gap:10px;">
              <button id="btn-start-terminal" class="diag-btn">Open Terminal</button>
              <button id="btn-stop-terminal" class="diag-btn" disabled style="background:#4a1919; color:#ef5350;">Disconnect</button>
              <span id="terminal-status" style="color:#8f98a0; font-size:13px;">Not connected</span>
            </div>
            <div id="terminal-container" style="display:none; height:400px;"></div>
          </div>

          <!-- Full-width: Activity History -->
          <h2 class="section-title" style="margin-top:20px;">Activity History</h2>
          <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:16px; margin-bottom:20px;">
            <div class="activity-filter-bar">
              <select id="activity-category-filter" style="min-width:160px;">
                <option value="">All</option>
                <option value="script_requested,script_completed">Scripts</option>
                <option value="terminal_session_started,terminal_session_ended">Terminal</option>
                <option value="desktop_session_started,desktop_session_ended">Desktop</option>
                <option value="file_browse_requested,file_browse_completed,file_read_requested,file_read_completed">Files</option>
                <option value="system_tool_requested,system_tool_completed">System Tools</option>
                <option value="diagnostic_requested,diagnostic_completed">Diagnostics</option>
                <option value="remediation_requested,remediation_executed,auto_remediation_triggered">Remediation</option>
                <option value="ticket_created,ticket_updated,ticket_comment_added">Tickets</option>
                <option value="alert_acknowledged,alert_resolved">Alerts</option>
              </select>
              <label style="font-size:12px; color:#8f98a0;">From</label>
              <input type="date" id="activity-date-from" />
              <label style="font-size:12px; color:#8f98a0;">To</label>
              <input type="date" id="activity-date-to" />
              <button class="diag-btn" id="btn-activity-apply">Apply</button>
              <button class="diag-btn" id="btn-activity-reset" style="background:none; border-color:#2a475e; color:#8f98a0;">Reset</button>
            </div>
            <div style="max-height:500px; overflow-y:auto;" id="activity-table-wrapper">
              <table class="activity-table">
                <thead>
                  <tr>
                    <th style="width:160px;">Timestamp</th>
                    <th style="width:180px;">Action</th>
                    <th style="width:120px;">Actor</th>
                    <th>Details</th>
                  </tr>
                </thead>
                <tbody id="activity-tbody">
                  <tr><td colspan="4" style="color:#8f98a0; text-align:center; padding:24px;">No activity loaded.</td></tr>
                </tbody>
              </table>
            </div>
            <div id="activity-load-more" style="display:none; margin-top:12px; text-align:center;">
              <button class="diag-btn" id="btn-activity-load-more">Load More</button>
            </div>
          </div>

          <!-- Danger zone -->
          <div style="padding-top:16px; border-top:1px solid #2a475e;">
            <button class="diag-btn" id="btn-remove-device" style="background:#4a1919; color:#ef5350;">Remove Device</button>
            <span style="font-size:12px; color:#8f98a0; margin-left:8px;">Removes device and all its data. Device must re-enroll.</span>
          </div>
        </div>

        <!-- Tickets page -->
        <div class="page" id="page-tickets">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                <h2 class="section-title" style="margin-bottom:0;">Support Tickets</h2>
                <button class="diag-btn" id="btn-new-ticket" style="background:#66c0f4; color:#1b2838; font-weight:600; padding:8px 16px;">+ New Ticket</button>
            </div>
            <!-- Create ticket form -->
            <div id="create-ticket-form" class="client-form" style="display:none; margin-bottom:20px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                    <span style="font-weight:600; color:#c7d5e0;">New Support Ticket</span>
                    <button class="diag-btn" id="btn-cancel-ticket-form" style="font-size:12px; padding:4px 10px;">Cancel</button>
                </div>
                <div style="display:flex; gap:16px; flex-wrap:wrap;">
                    <div style="flex:1; min-width:250px;">
                        <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Title *</label>
                        <input type="text" id="new-ticket-title" placeholder="Brief description of the issue" style="width:100%; box-sizing:border-box;">
                    </div>
                    <div style="min-width:200px; position:relative;">
                        <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Device *</label>
                        <input type="hidden" id="new-ticket-device" value="">
                        <div style="position:relative;">
                            <input type="text" id="new-ticket-device-search" placeholder="Search device..." autocomplete="off"
                                style="width:100%; box-sizing:border-box;">
                            <div id="new-ticket-device-dropdown" style="display:none; position:absolute; top:100%; left:0; right:0; z-index:50; max-height:180px; overflow-y:auto; background:#0f1923; border:1px solid #2a475e; border-top:none; border-radius:0 0 6px 6px; box-shadow:0 4px 12px rgba(0,0,0,0.4);"></div>
                        </div>
                    </div>
                </div>
                <div style="display:flex; gap:16px; margin-top:12px; flex-wrap:wrap;">
                    <div style="min-width:120px;">
                        <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Priority</label>
                        <select id="new-ticket-priority" style="width:100%; padding:8px 10px; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; border-radius:6px; font-size:13px;">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                            <option value="critical">Critical</option>
                        </select>
                    </div>
                    <div style="min-width:120px;">
                        <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Category</label>
                        <input type="text" id="new-ticket-category" placeholder="e.g. Hardware, Network" style="width:100%; box-sizing:border-box;">
                    </div>
                </div>
                <div style="margin-top:12px;">
                    <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Description</label>
                    <textarea id="new-ticket-description" placeholder="Detailed description of the issue, steps to reproduce, etc." style="width:100%; min-height:80px; box-sizing:border-box; resize:vertical;"></textarea>
                </div>
                <div style="margin-top:12px; display:flex; gap:8px;">
                    <button class="diag-btn" id="btn-submit-ticket" style="background:#66c0f4; color:#1b2838; font-weight:600; padding:8px 20px;">Create Ticket</button>
                    <button class="diag-btn" id="btn-cancel-ticket-form2">Cancel</button>
                </div>
            </div>
            <ul class="ticket-list" id="ticket-list">
                <div class="empty-state">No tickets yet.</div>
            </ul>
            <!-- Ticket detail panel -->
            <div class="detail-panel" id="ticket-detail">
                <div class="panel-header">
                    <h3 id="ticket-detail-title">Ticket</h3>
                    <button class="close-btn" id="btn-close-ticket">Close</button>
                </div>
                <div id="ticket-detail-info" style="font-size:13px; color:#8f98a0; margin-bottom:16px;"></div>
                <div id="ticket-detail-description" style="background:#0f1923; border:1px solid #2a475e; border-radius:8px; padding:12px; margin-bottom:16px; font-size:13px; line-height:1.5;"></div>
                <div style="display:flex; gap:12px; margin-bottom:16px;">
                    <div>
                        <label style="font-size:12px; color:#8f98a0;">Status</label>
                        <select id="ticket-status-select" style="display:block; margin-top:4px; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:6px 10px; border-radius:4px; font-size:13px;">
                            <option value="open">Open</option>
                            <option value="in_progress">In Progress</option>
                            <option value="resolved">Resolved</option>
                            <option value="closed">Closed</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-size:12px; color:#8f98a0;">Priority</label>
                        <select id="ticket-priority-select" style="display:block; margin-top:4px; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:6px 10px; border-radius:4px; font-size:13px;">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="critical">Critical</option>
                        </select>
                    </div>
                </div>
                <h4 style="margin:16px 0 8px; color:#c7d5e0;">Comments</h4>
                <div id="ticket-comments" style="margin-bottom:12px;"></div>
                <div class="chat-input-row">
                    <input type="text" id="ticket-comment-input" placeholder="Add a comment..." />
                    <button id="btn-add-ticket-comment">Comment</button>
                </div>
            </div>
        </div>


        <!-- Alerts page -->
        <div class="page" id="page-alerts">
            <div class="stats-row">
                <div class="stat-card">
                    <div class="value" id="alert-stat-active" style="color: #ef5350;">0</div>
                    <div class="label">Active Alerts</div>
                </div>
                <div class="stat-card">
                    <div class="value" id="alert-stat-critical" style="color: #d50000;">0</div>
                    <div class="label">Critical</div>
                </div>
                <div class="stat-card">
                    <div class="value" id="alert-stat-warning" style="color: #ffa726;">0</div>
                    <div class="label">Warning</div>
                </div>
            </div>

            <div class="alert-filter-row" id="alert-filter-row">
                <button class="alert-filter-btn active" data-filter="active">Active</button>
                <button class="alert-filter-btn" data-filter="all">All History</button>
            </div>

            <h2 class="section-title">Alerts</h2>
            <ul class="alert-list" id="alert-list">
                <div class="empty-state">No alerts.</div>
            </ul>

            <div style="margin-top: 32px;">
                <h2 class="section-title">Threshold Configuration</h2>
                <div class="alert-section">
                    <table class="threshold-table" id="threshold-table">
                        <thead>
                            <tr>
                                <th>Check Type</th>
                                <th>Field</th>
                                <th>Condition</th>
                                <th>Severity</th>
                                <th>Consecutive</th>
                                <th>Enabled</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="threshold-tbody"></tbody>
                    </table>
                </div>
            </div>

            <div style="margin-top: 24px;">
                <h2 class="section-title">Notification Channels</h2>
                <div class="alert-section">
                    <table class="channel-table" id="channel-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Enabled</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="channel-tbody"></tbody>
                    </table>
                    <button class="diag-btn" id="btn-show-add-channel" style="margin-top: 12px;">Add Channel</button>
                    <div id="add-channel-form" style="display: none; margin-top: 12px; background: #0f1923; border: 1px solid #2a475e; border-radius: 6px; padding: 16px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                            <input type="text" id="channel-name" placeholder="Channel name" style="background:#1b2838; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; font-size:13px;" />
                            <select id="channel-type" style="background:#1b2838; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; font-size:13px;">
                                <option value="webhook">Webhook</option>
                                <option value="slack">Slack</option>
                                <option value="teams">Teams</option>
                            </select>
                        </div>
                        <input type="text" id="channel-url" placeholder="Webhook URL" style="width:100%; background:#1b2838; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; font-size:13px; margin-bottom:8px;" />
                        <div style="display: flex; gap: 8px;">
                            <button class="diag-btn" id="btn-save-channel">Save</button>
                            <button class="diag-btn" id="btn-cancel-channel">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 24px;">
                <h2 class="section-title">Auto-Remediation Policies</h2>
                <div class="alert-section">
                    <p style="font-size: 12px; color: #8f98a0; margin-bottom: 12px;">When an alert threshold is triggered, auto-remediation can automatically execute a fix action.</p>
                    <table class="policy-table" id="policy-table">
                        <thead>
                            <tr>
                                <th>Threshold</th>
                                <th>Action</th>
                                <th>Parameter</th>
                                <th>Cooldown</th>
                                <th>Consent</th>
                                <th>Enabled</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="policy-tbody"></tbody>
                    </table>
                    <button class="diag-btn" id="btn-show-add-policy" style="margin-top: 12px;">Add Policy</button>
                    <div id="add-policy-form" style="display:none; margin-top:12px; background:#0f1923; border:1px solid #2a475e; border-radius:6px; padding:16px;">
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:8px;">
                            <select id="policy-threshold" style="background:#1b2838; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; font-size:13px;"></select>
                            <select id="policy-action" style="background:#1b2838; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; font-size:13px;">
                                <option value="flush_dns">Flush DNS</option>
                                <option value="clear_temp">Clear Temp Files</option>
                                <option value="clear_browser_cache">Clear Browser Cache</option>
                                <option value="restart_spooler">Restart Spooler</option>
                                <option value="repair_network">Repair Network</option>
                                <option value="restart_service">Restart Service</option>
                            </select>
                        </div>
                        <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; margin-bottom:8px;">
                            <input type="text" id="policy-parameter" placeholder="Parameter (optional)" style="background:#1b2838; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; font-size:13px;" />
                            <input type="number" id="policy-cooldown" placeholder="Cooldown (min)" value="30" style="background:#1b2838; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; font-size:13px;" />
                            <label style="display:flex; align-items:center; gap:6px; font-size:13px; color:#c7d5e0;">
                                <input type="checkbox" id="policy-consent" checked /> Require consent
                            </label>
                        </div>
                        <div style="display:flex; gap:8px;">
                            <button class="diag-btn" id="btn-save-policy">Save</button>
                            <button class="diag-btn" id="btn-cancel-policy">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clients page (admin only) -->
        <div class="page" id="page-clients">
            <h2 class="section-title">Client Management</h2>
            <div class="client-form" id="client-create-form">
                <h3 style="margin-bottom: 12px; color: #c7d5e0;">Add New Client</h3>
                <label>Name *</label>
                <input type="text" id="new-client-name" placeholder="e.g. Acme Corp">
                <label>Contact Name</label>
                <input type="text" id="new-client-contact" placeholder="e.g. John Smith">
                <label>Contact Email</label>
                <input type="email" id="new-client-email" placeholder="e.g. john@acme.com">
                <label>Notes</label>
                <textarea id="new-client-notes" rows="2" placeholder="Optional notes..."></textarea>
                <button class="diag-btn" id="btn-create-client">Create Client</button>
            </div>
            <table class="client-table">
                <thead><tr><th>Name</th><th>Devices</th><th>Contact</th><th>Created</th><th>Actions</th></tr></thead>
                <tbody id="client-table-body"></tbody>
            </table>
            <div id="client-users-panel" style="display:none; margin-top: 24px; background: #1b2838; border: 1px solid #2a475e; border-radius: 8px; padding: 20px;">
                <h3 style="color: #c7d5e0; margin-bottom: 12px;">Assigned Technicians — <span id="client-users-title"></span></h3>
                <div id="client-users-list"></div>
                <div style="margin-top: 12px;">
                    <select id="assign-user-select" style="padding: 6px 10px; background: #0f1923; border: 1px solid #2a475e; border-radius: 6px; color: #c7d5e0;"></select>
                    <button class="diag-btn" id="btn-assign-user" style="margin-left: 8px;">Assign</button>
                </div>
            </div>
        </div>

        <!-- Reports page -->
        <div class="page" id="page-reports">
  <!-- Time range selector -->
  <div style="display:flex; align-items:center; gap:12px; margin-bottom:20px; flex-wrap:wrap;">
    <span style="color:#8f98a0; font-size:13px;">Time Range:</span>
    <button class="diag-btn report-range-btn active" data-days="7">7 Days</button>
    <button class="diag-btn report-range-btn" data-days="30">30 Days</button>
    <button class="diag-btn report-range-btn" data-days="90">90 Days</button>
    <div style="flex:1;"></div>
    <button class="diag-btn" id="btn-export-csv" style="background:#2a475e;">Export CSV</button>
    <button class="diag-btn" id="btn-export-pdf" style="background:#2a475e;">Export PDF</button>
  </div>

  <!-- Fleet Health Trend -->
  <h2 class="section-title">Fleet Health Trend</h2>
  <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:20px; margin-bottom:20px;">
    <canvas id="chart-fleet-health" height="80"></canvas>
  </div>

  <!-- Alert Summary -->
  <h2 class="section-title">Alert Summary</h2>
  <div class="stats-row" id="alert-summary-stats" style="margin-bottom:16px;">
    <div class="stat-card" data-page="alerts"><div class="value" id="stat-alert-total">0</div><div class="label">Total Alerts</div></div>
    <div class="stat-card" data-page="alerts"><div class="value" id="stat-alert-active" style="color:#ef5350;">0</div><div class="label">Active</div></div>
    <div class="stat-card" data-page="alerts"><div class="value" id="stat-alert-resolved" style="color:#66bb6a;">0</div><div class="label">Resolved</div></div>
    <div class="stat-card" data-page="alerts"><div class="value" id="stat-alert-mttr">-</div><div class="label">MTTR (hours)</div></div>
  </div>
  <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:20px;">
    <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:20px;">
      <canvas id="chart-alerts-per-day" height="100"></canvas>
    </div>
    <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:20px;">
      <canvas id="chart-alerts-by-severity" height="100"></canvas>
    </div>
  </div>

  <!-- Ticket Summary -->
  <h2 class="section-title">Ticket Summary</h2>
  <div class="stats-row" id="ticket-summary-stats" style="margin-bottom:16px;">
    <div class="stat-card" data-page="tickets"><div class="value" id="stat-ticket-total">0</div><div class="label">Total Tickets</div></div>
    <div class="stat-card" data-page="tickets"><div class="value" id="stat-ticket-open" style="color:#ffa726;">0</div><div class="label">Open</div></div>
    <div class="stat-card" data-page="tickets"><div class="value" id="stat-ticket-resolved" style="color:#66bb6a;">0</div><div class="label">Resolved</div></div>
    <div class="stat-card" data-page="tickets"><div class="value" id="stat-ticket-avgres">-</div><div class="label">Avg Resolution (hours)</div></div>
  </div>
  <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:20px; margin-bottom:20px;">
    <canvas id="chart-tickets-per-day" height="80"></canvas>
  </div>

  <!-- Device Drill-down -->
  <h2 class="section-title">Device Drill-down</h2>
  <div style="display:flex; gap:12px; align-items:center; margin-bottom:12px;">
    <select id="report-device-select" style="background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px 12px; border-radius:4px; min-width:200px;">
      <option value="">Select a device...</option>
    </select>
    <select id="report-metric-select" style="background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px 12px; border-radius:4px;">
      <option value="cpu">CPU Usage</option>
      <option value="memory">Memory Usage</option>
      <option value="disk">Disk Usage</option>
    </select>
    <button class="diag-btn" id="btn-load-device-metrics">Load</button>
  </div>
  <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:20px; margin-bottom:20px;">
    <canvas id="chart-device-metrics" height="80"></canvas>
    <div id="device-metrics-empty" class="empty-state" style="display:none;">Select a device and metric to view trends</div>
  </div>

  <!-- Scheduled Reports -->
  <h2 class="section-title">Scheduled Reports</h2>
  <div style="margin-bottom:12px;">
    <button class="diag-btn" id="btn-show-schedule-form" style="background:#66c0f4; color:#1b2838; font-weight:600;">+ New Schedule</button>
  </div>
  <div id="schedule-form" style="display:none; background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:20px; margin-bottom:16px;">
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
      <div>
        <label style="color:#8f98a0; font-size:12px; display:block; margin-bottom:4px;">Name</label>
        <input type="text" id="sched-name" style="background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; width:100%; box-sizing:border-box;">
      </div>
      <div>
        <label style="color:#8f98a0; font-size:12px; display:block; margin-bottom:4px;">Report Type</label>
        <select id="sched-type" style="background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; width:100%; box-sizing:border-box;">
          <option value="fleet_health">Fleet Health</option>
          <option value="alert_summary">Alert Summary</option>
          <option value="ticket_summary">Ticket Summary</option>
          <option value="device_metrics">Device Metrics</option>
        </select>
      </div>
      <div>
        <label style="color:#8f98a0; font-size:12px; display:block; margin-bottom:4px;">Cron Schedule</label>
        <input type="text" id="sched-cron" placeholder="0 8 * * 1" style="background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; width:100%; box-sizing:border-box;">
        <span style="color:#8f98a0; font-size:11px;">e.g. 0 8 * * 1 = Mon 8am</span>
      </div>
      <div>
        <label style="color:#8f98a0; font-size:12px; display:block; margin-bottom:4px;">Format</label>
        <select id="sched-format" style="background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; width:100%; box-sizing:border-box;">
          <option value="csv">CSV</option>
          <option value="pdf">PDF</option>
        </select>
      </div>
    </div>
    <div style="margin-top:12px; display:flex; gap:8px; justify-content:flex-end;">
      <button class="diag-btn" id="btn-cancel-schedule">Cancel</button>
      <button class="diag-btn" id="btn-save-schedule" style="background:#66c0f4; color:#1b2838; font-weight:600;">Save</button>
    </div>
  </div>
  <div id="schedules-list"></div>

  <!-- Report History -->
  <h2 class="section-title" style="margin-top:24px;">Report History</h2>
  <div id="report-history-list"></div>
        </div>

        <!-- Updates page -->
        <div class="page" id="page-updates">
            <h2 class="section-title">Update Management</h2>

            <!-- Expected client version info -->
            <div id="expected-version-card" style="display:flex; gap:16px; margin-bottom:24px; align-items:center; background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:16px 24px; flex-wrap:wrap;">
                <div>
                    <div style="font-size:12px; color:#8f98a0; margin-bottom:4px;">Expected Client Version</div>
                    <div id="expected-version" style="font-size:28px; font-weight:700; color:#66c0f4;">—</div>
                </div>
                <div style="border-left:1px solid #2a475e; padding-left:16px;">
                    <div style="font-size:12px; color:#8f98a0; margin-bottom:4px;">Fleet Status</div>
                    <div id="fleet-update-status" style="font-size:14px; color:#c7d5e0;">Loading...</div>
                </div>
                <div style="margin-left:auto;">
                    <button id="btn-client-check" class="diag-btn" style="padding:8px 16px;">Check for Client Update</button>
                </div>
            </div>

            <!-- Fleet version distribution -->
            <h2 class="section-title">Fleet Versions</h2>
            <div class="stats-row" id="fleet-versions-row" style="margin-bottom: 24px;"></div>

            <!-- Uploaded packages -->
            <h2 class="section-title">Uploaded Packages</h2>
            <table class="client-table">
                <thead><tr><th>Version</th><th>File Size</th><th>SHA-256</th><th>Uploaded</th><th>Actions</th></tr></thead>
                <tbody id="updates-table-body"></tbody>
            </table>
        </div>

        <!-- Deploy page -->
        <div class="page" id="page-deploy">
            <h2 class="section-title">Deploy Scripts &amp; Files</h2>
            <div class="deploy-tabs" id="deploy-tabs">
                <button class="diag-btn active" id="deploy-tab-new" data-tab="new">New Deployment</button>
                <button class="diag-btn" id="deploy-tab-history" data-tab="history">Deployment History</button>
                <button class="diag-btn" id="deploy-tab-templates" data-tab="templates">Templates</button>
            </div>

            <!-- New Deployment Form -->
            <div id="deploy-new" class="client-form">
                <!-- General + Script/File panels side by side -->
                <div class="deploy-form-row">
                    <!-- Name & Type -->
                    <div class="deploy-section">
                        <div class="deploy-section-title">General</div>
                        <div style="display:flex; gap:8px; align-items:center; margin-bottom:12px;">
                            <select id="deploy-template-select" style="flex:1; padding:6px 10px; font-size:13px; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; border-radius:6px;">
                                <option value="">Load from template...</option>
                            </select>
                            <button class="diag-btn" id="btn-save-deploy-template" style="font-size:12px; padding:5px 12px; white-space:nowrap;">Save as Template</button>
                        </div>
                        <label>Deployment Name</label>
                        <input type="text" id="deploy-name" placeholder="e.g. Install Chrome, Run cleanup script" style="width:100%;">

                        <label>Type</label>
                        <div class="deploy-radio-group" id="deploy-type-group">
                            <label><input type="radio" name="deploy-type" value="script" checked> Script</label>
                            <label><input type="radio" name="deploy-type" value="installer"> File</label>
                        </div>
                        <div style="display:flex; align-items:center; gap:12px; margin-top:4px;">
                            <div>
                                <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Timeout</label>
                                <input type="number" id="deploy-timeout" value="300" min="30" max="600" class="deploy-input-sm">
                            </div>
                            <span style="font-size:11px; color:#8f98a0; margin-top:18px;">seconds (30-600)</span>
                        </div>
                    </div>

                    <!-- Script panel -->
                    <div id="deploy-script-panel" class="deploy-section">
                        <div class="deploy-section-title">Script Configuration</div>
                        <label>Library Script</label>
                        <select id="deploy-script-select" class="deploy-select">
                            <option value="">-- Ad-hoc script --</option>
                        </select>
                        <label>Script Content</label>
                        <textarea id="deploy-script-content" class="deploy-textarea" placeholder="Enter PowerShell script..."></textarea>
                        <div class="deploy-checkbox-box">
                            <label class="deploy-checkbox-label">
                                <input type="checkbox" id="deploy-elevation"> Requires elevation
                            </label>
                        </div>
                    </div>

                    <!-- File panel -->
                    <div id="deploy-installer-panel" class="deploy-section" style="display:none;">
                        <div class="deploy-section-title">File Configuration</div>
                        <label>File (.exe, .msi, .ps1, .bat — max 50MB)</label>
                        <input type="file" id="deploy-installer-file" accept=".exe,.msi,.ps1,.bat" style="margin:8px 0;">
                        <div id="deploy-installer-info" class="deploy-file-info"></div>
                        <label>Silent Arguments</label>
                        <input type="text" id="deploy-silent-args" placeholder="e.g. /S or /qn ALLUSERS=1" style="width:100%;">
                    </div>
                </div>

                <!-- Target Devices -->
                <div class="deploy-section">
                    <div class="deploy-section-title">Target Devices</div>
                    <div style="display:flex; gap:8px; align-items:center; margin-bottom:10px; flex-wrap:wrap;">
                        <div class="deploy-btn-row" style="margin:0;">
                            <button class="diag-btn" id="btn-deploy-select-online">Select All Online</button>
                            <button class="diag-btn" id="btn-deploy-select-all">Select All</button>
                            <button class="diag-btn" id="btn-deploy-select-none">Clear</button>
                        </div>
                        <span style="color:#2a475e; margin:0 2px;">|</span>
                        <select id="deploy-filter-client" class="deploy-input-sm" style="width:150px;">
                            <option value="">All Clients</option>
                        </select>
                        <input type="text" id="deploy-filter-search" placeholder="Search hostname..." class="deploy-input-sm" style="width:160px;">
                        <span id="deploy-selected-count" style="font-size:12px; color:#66c0f4; margin-left:auto;">0 selected</span>
                    </div>
                    <div id="deploy-device-list" class="deploy-device-grid"></div>
                </div>

                <!-- Schedule -->
                <div class="deploy-section">
                    <div class="deploy-section-title">Schedule</div>
                    <div class="deploy-radio-group" id="deploy-schedule-group">
                        <label><input type="radio" name="deploy-schedule" value="now" checked> Run immediately</label>
                        <label><input type="radio" name="deploy-schedule" value="later"> Schedule for later</label>
                    </div>
                    <div id="deploy-schedule-picker" style="display:none;">
                        <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
                            <div>
                                <label style="font-size:11px; color:#8f98a0; display:block; margin-bottom:4px;">Date</label>
                                <input type="date" id="deploy-schedule-date" class="deploy-schedule-input">
                            </div>
                            <div>
                                <label style="font-size:11px; color:#8f98a0; display:block; margin-bottom:4px;">Time</label>
                                <input type="time" id="deploy-schedule-time-input" class="deploy-schedule-input">
                            </div>
                            <div id="deploy-schedule-preview" style="font-size:12px; color:#66c0f4; margin-top:16px;"></div>
                        </div>
                    </div>
                </div>

                <div style="margin-top:8px; padding-top:16px; border-top:1px solid #2a475e;">
                    <button class="deploy-submit" id="btn-deploy-submit">Deploy</button>
                </div>
            </div>

            <!-- Deployment History -->
            <div id="deploy-history" style="display:none;">
                <div id="deploy-history-list">
                    <div style="color:#8f98a0; text-align:center; padding:24px;">Loading...</div>
                </div>
            </div>

            <!-- Templates -->
            <div id="deploy-templates" style="display:none;">
                <div id="deploy-templates-list">
                    <div style="color:#8f98a0; text-align:center; padding:24px;">Loading...</div>
                </div>
            </div>
        </div>

        <!-- Wishlist page -->
        <div class="page" id="page-wishlist">
            <h2 class="section-title">Feature Wishlist</h2>
            <p style="font-size:13px; color:#8f98a0; margin-bottom:20px;">Capability gaps logged by the AI when it can't fulfill user requests.</p>

            <!-- Stats bar -->
            <div class="wish-stats-bar">
                <div class="wish-stat">
                    <div class="ws-value" id="wish-stat-total">—</div>
                    <div class="ws-label">Total Wishes</div>
                </div>
                <div class="wish-stat">
                    <div class="ws-value" id="wish-stat-top-cat">—</div>
                    <div class="ws-label">Top Category</div>
                </div>
                <div class="wish-stat">
                    <div class="ws-value" id="wish-stat-top-votes">—</div>
                    <div class="ws-label">Most Voted</div>
                </div>
            </div>

            <!-- Filters -->
            <div class="wish-filter-row">
                <select id="wish-filter-status">
                    <option value="">All Statuses</option>
                    <option value="pending" selected>Pending</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                    <option value="implemented">Implemented</option>
                </select>
                <select id="wish-filter-category">
                    <option value="">All Categories</option>
                    <option value="software">Software</option>
                    <option value="network">Network</option>
                    <option value="security">Security</option>
                    <option value="hardware">Hardware</option>
                    <option value="account">Account</option>
                    <option value="automation">Automation</option>
                    <option value="other">Other</option>
                </select>
                <button class="diag-btn" id="btn-refresh-wishes">Refresh</button>
            </div>

            <!-- Wishes table -->
            <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; overflow:hidden;">
                <table class="wish-table">
                    <thead>
                        <tr>
                            <th style="width:52px;">Votes</th>
                            <th style="width:110px;">Category</th>
                            <th>AI Need</th>
                            <th>User Request</th>
                            <th>Device</th>
                            <th style="width:100px;">Status</th>
                            <th style="width:190px;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="wish-tbody">
                        <tr><td colspan="7" style="text-align:center; padding:32px; color:#8f98a0;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Settings page -->
        <div class="page" id="page-settings">
            <h2 class="section-title">Server Settings</h2>

            <!-- Server Configuration -->
            <div class="client-form" style="margin-bottom: 24px;">
                <h3 style="margin-bottom: 12px; color: #c7d5e0;">Server Configuration</h3>
                <label>Public URL <span style="font-size:11px;color:#8f98a0;">(how clients reach this server)</span></label>
                <input type="text" id="setting-server-url" placeholder="e.g. http://10.0.0.5:9100" style="max-width:400px;">
            </div>

            <!-- AI/LLM Configuration -->
            <div class="client-form" style="margin-bottom: 24px;">
                <h3 style="margin-bottom: 12px; color: #c7d5e0;">AI / LLM Configuration</h3>

                <label>Provider</label>
                <select id="setting-llm-provider" style="max-width:250px;padding:6px 10px;background:#1b2838;color:#c7d5e0;border:1px solid #2a475e;border-radius:4px;">
                    <option value="ollama">Ollama (Local)</option>
                    <option value="openai">OpenAI</option>
                    <option value="anthropic">Anthropic</option>
                    <option value="claude-cli">Claude CLI</option>
                </select>

                <!-- Ollama settings -->
                <div id="llm-ollama-settings" style="margin-top:12px;">
                    <label>Ollama URL</label>
                    <input type="text" id="setting-ollama-url" placeholder="http://localhost:11434" style="max-width:400px;">
                    <label>Ollama Model</label>
                    <input type="text" id="setting-ollama-model" placeholder="llama3.2" style="max-width:250px;">
                </div>

                <!-- OpenAI settings -->
                <div id="llm-openai-settings" style="margin-top:12px;display:none;">
                    <label>API Key</label>
                    <input type="password" id="setting-openai-key" placeholder="sk-..." style="max-width:400px;">
                    <label>Model</label>
                    <input type="text" id="setting-openai-model" placeholder="gpt-4o-mini" style="max-width:250px;">
                </div>

                <!-- Anthropic settings -->
                <div id="llm-anthropic-settings" style="margin-top:12px;display:none;">
                    <label>API Key</label>
                    <input type="password" id="setting-anthropic-key" placeholder="sk-ant-..." style="max-width:400px;">
                    <label>Model</label>
                    <input type="text" id="setting-anthropic-model" placeholder="claude-sonnet-4-5-20250929" style="max-width:250px;">
                </div>

                <!-- Claude CLI settings -->
                <div id="llm-claude-cli-settings" style="margin-top:12px;display:none;">
                    <label>Model <span style="font-size:11px;color:#8f98a0;">(leave empty for default)</span></label>
                    <input type="text" id="setting-claude-cli-model" placeholder="(default)" style="max-width:250px;">
                </div>

                <div style="display:flex;align-items:center;gap:12px;margin-top:16px;">
                    <button class="diag-btn" id="test-llm-btn-inline" style="background:#1a3a5c;">Test Connection</button>
                    <span id="test-llm-status" style="font-size:12px;color:#8f98a0;"></span>
                </div>

                <div style="margin-top:16px;">
                    <label style="font-size:13px; color:#8f98a0;">Response Timeout</label>
                    <div style="display:flex; align-items:center; gap:8px; margin-top:4px;">
                        <input type="number" id="setting-llm-timeout" value="120" min="15" max="600" style="width:80px;padding:6px 10px;background:#0f1923;border:1px solid #2a475e;color:#c7d5e0;border-radius:4px;font-size:13px;">
                        <span style="font-size:12px; color:#8f98a0;">seconds (15-600). How long to wait for LLM response before timing out.</span>
                    </div>
                </div>
            </div>

            <!-- System Info (read-only) -->
            <div class="client-form" style="margin-bottom: 24px;">
                <h3 style="margin-bottom: 12px; color: #c7d5e0;">System Information</h3>
                <div style="display:grid;grid-template-columns:150px 1fr;gap:8px;font-size:13px;">
                    <span style="color:#8f98a0;">Server Port:</span>
                    <span id="sys-info-port" style="color:#c7d5e0;">-</span>
                    <span style="color:#8f98a0;">Database Size:</span>
                    <span id="sys-info-db-size" style="color:#c7d5e0;">-</span>
                    <span style="color:#8f98a0;">Active Provider:</span>
                    <span id="sys-info-provider" style="color:#c7d5e0;">-</span>
                    <span style="color:#8f98a0;">Online Devices:</span>
                    <span id="sys-info-devices" style="color:#c7d5e0;">-</span>
                </div>
            </div>

            <!-- Server Update -->
            <div class="client-form" style="margin-bottom: 24px;" id="server-update-card">
                <h3 style="margin-bottom: 12px; color: #c7d5e0;">Server Update</h3>
                <div style="display:grid;grid-template-columns:150px 1fr;gap:8px;font-size:13px;margin-bottom:16px;">
                    <span style="color:#8f98a0;">Server version:</span>
                    <span id="srv-update-version" style="color:#c7d5e0;">—</span>
                    <span style="color:#8f98a0;">Current commit:</span>
                    <span id="srv-update-commit" style="color:#c7d5e0;">—</span>
                    <span style="color:#8f98a0;">Last checked:</span>
                    <span id="srv-update-checked" style="color:#8f98a0;">Never</span>
                </div>
                <div style="margin-bottom:12px;">
                    <button class="diag-btn" id="btn-check-update" style="padding:8px 18px;">Check for Updates</button>
                </div>
                <div id="srv-update-result" style="display:none;margin-bottom:12px;padding:12px;background:#0f1923;border:1px solid #2a475e;border-radius:6px;font-size:13px;">
                    <div id="srv-update-status" style="color:#66c0f4;margin-bottom:8px;font-weight:bold;"></div>
                    <div id="srv-update-details" style="color:#c7d5e0;"></div>
                    <div id="srv-update-commits" style="color:#8f98a0;margin-top:8px;font-size:12px;max-height:120px;overflow-y:auto;"></div>
                    <div style="margin-top:12px;display:none;" id="srv-update-apply-wrap">
                        <button class="diag-btn" id="btn-apply-update" style="padding:8px 18px;background:#b45309;border-color:#d97706;">Update Server</button>
                        <span style="font-size:11px;color:#fbbf24;margin-left:8px;">Server will restart</span>
                    </div>
                </div>
                <div id="srv-update-progress" style="display:none;padding:12px;background:#0f1923;border:1px solid #2a475e;border-radius:6px;font-size:13px;">
                    <div id="srv-update-progress-steps"></div>
                </div>
            </div>

            <!-- Save button -->
            <div style="display:flex;align-items:center;gap:12px;">
                <button class="diag-btn" id="btn-save-settings" style="padding:10px 24px;font-size:14px;">Save Settings</button>
                <button id="test-llm-btn" style="background:#2563eb; color:white; border:none; border-radius:6px; padding:8px 18px; cursor:pointer; font-size:14px; margin-left:10px;">Test LLM Connection</button>
                <span id="save-settings-status" style="font-size:12px;color:#8f98a0;"></span>
            </div>
            <div id="llm-test-result" style="display:none; margin-top:8px; padding:8px 12px; border-radius:6px; background:#1a1a2e; font-size:13px;"></div>
        </div>

        <div class="page" id="page-users">
            <h2 style="margin-bottom:16px;">IT Users</h2>
            <div style="display:flex; gap:12px; margin-bottom:16px; align-items:flex-end; flex-wrap:wrap;">
                <div>
                    <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Username *</label>
                    <input type="text" id="user-new-username" placeholder="Username" style="width:160px;">
                </div>
                <div>
                    <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Display Name</label>
                    <input type="text" id="user-new-displayname" placeholder="Display Name" style="width:180px;">
                </div>
                <div>
                    <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Password *</label>
                    <input type="password" id="user-new-password" placeholder="Password" style="width:160px;">
                </div>
                <div>
                    <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Role</label>
                    <select id="user-new-role">
                        <option value="viewer">Viewer</option>
                        <option value="technician" selected>Technician</option>
                        <option value="admin">Admin</option>
                        <option value="superadmin">Superadmin</option>
                    </select>
                </div>
                <button class="diag-btn" id="btn-create-user" style="height:36px;">Add User</button>
            </div>
            <div id="user-message" style="display:none; padding:8px 12px; border-radius:6px; margin-bottom:12px; font-size:13px;"></div>
            <table style="width:100%; border-collapse:collapse;">
                <thead>
                    <tr style="border-bottom:1px solid #2a475e; text-align:left;">
                        <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">Username</th>
                        <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">Display Name</th>
                        <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">Role</th>
                        <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">2FA</th>
                        <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">Last Login</th>
                        <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">Created</th>
                        <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">Actions</th>
                    </tr>
                </thead>
                <tbody id="users-table-body"></tbody>
            </table>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@xterm/addon-fit@0.10.0/lib/addon-fit.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="dashboard.js"></script>
</body>
</html>
