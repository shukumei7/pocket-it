<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pocket IT — Dashboard</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/css/xterm.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
</head>
<body>
    <!-- Login overlay -->
    <div id="login-overlay" style="position:fixed; top:0; left:0; right:0; bottom:0; background:#0f1923; z-index:1000; display:none; align-items:center; justify-content:center;">
        <div style="background:#1b2838; border:1px solid #2a475e; border-radius:12px; padding:40px; width:400px; text-align:center;">
            <div style="font-size:24px; font-weight:700; color:#66c0f4; margin-bottom:8px;">Pocket IT</div>
            <div id="login-subtitle" style="font-size:13px; color:#8f98a0; margin-bottom:24px;">IT Dashboard Login</div>
            <div id="login-error" style="display:none; background:#4a1919; color:#ef5350; padding:8px 12px; border-radius:6px; font-size:13px; margin-bottom:16px;"></div>

            <!-- Step 1: Password -->
            <div id="login-step-password">
                <input type="text" id="login-username" placeholder="Username" style="width:100%; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:10px 14px; border-radius:6px; font-size:14px; margin-bottom:12px;" />
                <input type="password" id="login-password" placeholder="Password" style="width:100%; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:10px 14px; border-radius:6px; font-size:14px; margin-bottom:16px;" />
                <button id="btn-login" style="width:100%; background:#66c0f4; color:#0f1923; border:none; padding:10px; border-radius:6px; font-size:14px; font-weight:600; cursor:pointer;">Sign In</button>
            </div>

            <!-- Step 2: TOTP verification (existing 2FA) -->
            <div id="login-step-totp" style="display:none;">
                <p style="color:#c7d5e0; font-size:13px; margin-bottom:16px;">Enter the 6-digit code from your authenticator app</p>
                <input type="text" id="login-totp-code" placeholder="000 000" maxlength="7" autocomplete="one-time-code" style="width:180px; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:12px 14px; border-radius:6px; font-size:20px; text-align:center; letter-spacing:4px; margin-bottom:8px;" />
                <p style="color:#8f98a0; font-size:11px; margin-bottom:16px;">Or enter an 8-character backup code</p>
                <button id="btn-verify-totp" style="width:100%; background:#66c0f4; color:#0f1923; border:none; padding:10px; border-radius:6px; font-size:14px; font-weight:600; cursor:pointer;">Verify</button>
                <button id="btn-back-to-login" style="width:100%; background:transparent; color:#8f98a0; border:1px solid #2a475e; padding:8px; border-radius:6px; font-size:13px; cursor:pointer; margin-top:8px;">Back</button>
            </div>

            <!-- Step 3: 2FA Setup (first time) -->
            <div id="login-step-setup" style="display:none;">
                <p style="color:#c7d5e0; font-size:13px; margin-bottom:16px;">Two-factor authentication is required. Scan this QR code with your authenticator app:</p>
                <div id="setup-qr-container" style="margin-bottom:16px;">
                    <img id="setup-qr-image" src="" alt="QR Code" style="width:200px; height:200px; border-radius:8px; background:#fff; padding:8px;" />
                </div>
                <details style="text-align:left; margin-bottom:16px;">
                    <summary style="color:#8f98a0; font-size:12px; cursor:pointer;">Manual entry key</summary>
                    <code id="setup-manual-key" style="display:block; background:#0f1923; color:#66c0f4; padding:8px 12px; border-radius:4px; font-size:13px; word-break:break-all; margin-top:8px;"></code>
                </details>
                <p style="color:#c7d5e0; font-size:13px; margin-bottom:12px;">Enter the code shown in your app to confirm:</p>
                <input type="text" id="setup-totp-code" placeholder="000 000" maxlength="7" autocomplete="one-time-code" style="width:180px; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:12px 14px; border-radius:6px; font-size:20px; text-align:center; letter-spacing:4px; margin-bottom:16px;" />
                <button id="btn-confirm-setup" style="width:100%; background:#66c0f4; color:#0f1923; border:none; padding:10px; border-radius:6px; font-size:14px; font-weight:600; cursor:pointer;">Activate 2FA</button>
            </div>

            <!-- Step 4: Backup codes display (shown after setup) -->
            <div id="login-step-backup" style="display:none;">
                <p style="color:#c7d5e0; font-size:13px; margin-bottom:8px;">Save these backup codes in a safe place. Each code can only be used once.</p>
                <div id="backup-codes-grid" style="display:grid; grid-template-columns:1fr 1fr; gap:6px; margin-bottom:16px; text-align:left;"></div>
                <button id="btn-copy-backup" style="width:100%; background:transparent; color:#8f98a0; border:1px solid #2a475e; padding:8px; border-radius:6px; font-size:13px; cursor:pointer; margin-bottom:8px;">Copy All Codes</button>
                <button id="btn-backup-done" style="width:100%; background:#66c0f4; color:#0f1923; border:none; padding:10px; border-radius:6px; font-size:14px; font-weight:600; cursor:pointer;">I've Saved My Codes</button>
            </div>
        </div>
    </div>

    <nav>
        <span class="logo">Pocket IT</span>
        <select id="client-selector" class="client-selector" style="display:none;">
            <option value="">All Clients</option>
        </select>
        <a href="#" class="nav-link active" data-page="fleet">Fleet</a>
        <a href="#" class="nav-link" data-page="tickets">Tickets</a>

        <a href="#" class="nav-link" data-page="alerts">Alerts <span id="nav-alert-badge" style="display:none; background:#ef5350; color:#fff; font-size:10px; padding:2px 6px; border-radius:8px; margin-left:4px;">0</span></a>
        <a href="#" class="nav-link" data-page="reports">Reports</a>
        <a href="#" class="nav-link" data-page="deploy">Deploy</a>
        <div id="nav-admin-dropdown" class="nav-dropdown" style="display:none; position:relative;">
            <a href="#" class="nav-link" id="nav-admin-toggle">Admin &#9662;</a>
            <div class="nav-dropdown-menu" style="display:none; position:absolute; top:100%; left:0; z-index:100; min-width:160px; background:#1b2838; border:1px solid #2a475e; border-radius:6px; box-shadow:0 4px 12px rgba(0,0,0,0.4); padding:4px 0;">
                <a href="#" class="nav-dropdown-item" data-page="clients">Clients</a>
                <a href="#" class="nav-dropdown-item" data-page="passwords">Passwords</a>
                <a href="#" class="nav-dropdown-item" data-page="scripts">Scripts</a>
                <a href="#" class="nav-dropdown-item" data-page="settings">Settings</a>
                <a href="#" class="nav-dropdown-item" data-page="updates">Updates</a>
                <a href="#" class="nav-dropdown-item" data-page="users">Users</a>
                <a href="#" class="nav-dropdown-item" data-page="wishlist">Wishlist</a>
            </div>
        </div>
        <span class="spacer"></span>
        <span class="status-badge" id="server-status">Connected</span>
        <a href="#" class="user-avatar" data-page="account" id="nav-user-avatar" title="My Account" style="display:none; margin-left:8px;"></a>
    </nav>

    <div class="container">
        <!-- Fleet page -->
        <div class="page" id="page-fleet">
            <div class="stats-row">
                <div class="stat-card" data-page="fleet">
                    <div class="value" id="stat-online">0</div>
                    <div class="label">Devices Online</div>
                </div>
                <div class="stat-card" data-page="fleet">
                    <div class="value" id="stat-total">0</div>
                    <div class="label">Total Devices</div>
                </div>
                <div class="stat-card" data-page="tickets">
                    <div class="value" id="stat-tickets-open">0</div>
                    <div class="label">Open Tickets</div>
                </div>
                <div class="stat-card" data-page="tickets">
                    <div class="value" id="stat-tickets-total">0</div>
                    <div class="label">Total Tickets</div>
                </div>
                <div class="stat-card" data-page="reports">
                    <div class="value" id="stat-health">—</div>
                    <div class="label">Avg Health Score</div>
                </div>
                <div class="stat-card" data-page="alerts">
                    <div class="value" id="stat-critical" style="color: #ef5350;">0</div>
                    <div class="label">Critical Devices</div>
                </div>
                <div class="stat-card" data-page="alerts">
                    <div class="value" id="stat-alerts" style="color: #ef5350;">0</div>
                    <div class="label">Active Alerts</div>
                </div>
            </div>

            <div style="display:flex; align-items:center; gap:12px; margin-bottom:4px;">
                <h2 class="section-title" style="margin-bottom:0;">Devices</h2>
                <button id="fleet-installer-btn" class="diag-btn" style="display:none; font-size:12px; padding:5px 14px;">Download Installer</button>
            </div>
            <div class="device-grid" id="device-grid">
                <div class="empty-state">No devices enrolled yet. Generate an enrollment token to get started.</div>
            </div>

        </div>

        <!-- Device detail page -->
        <div class="page" id="page-device">
          <!-- Back button + device header -->
          <div style="display:flex; align-items:center; gap:12px; margin-bottom:20px;">
            <button class="diag-btn" id="btn-back-to-fleet" style="font-size:18px; padding:4px 12px;">&larr;</button>
            <h2 id="detail-hostname" style="margin:0; color:#c7d5e0;">Device</h2>
            <span id="detail-status-dot" class="status-dot"></span>
            <span id="detail-device-id" style="font-size:12px; color:#8f98a0; font-family:monospace;"></span>
          </div>

          <div id="device-watchers" style="display:flex; gap:6px; align-items:center; margin-bottom:8px; min-height:24px; flex-wrap:wrap;"></div>
          <div id="device-ai-controls" style="display:flex; gap:8px; align-items:center; margin-bottom:12px;">
              <span style="font-size:12px; color:#8f98a0;">AI:</span>
              <button class="diag-btn" data-ai-mode="enabled" id="btn-ai-enabled">Enabled</button>
              <button class="diag-btn" data-ai-mode="temporary" id="btn-ai-temp">Disable Temporarily</button>
              <button class="diag-btn" data-ai-mode="permanent" id="btn-ai-perm">Disable Permanently</button>
          </div>

          <!-- Device info cards -->
          <div id="detail-info" class="stats-row" style="margin-bottom:20px;"></div>

          <!-- Custom Fields -->
          <div id="custom-fields-section" style="margin-bottom:20px;">
            <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
              <h3 style="margin:0; color:#c7d5e0; font-size:15px;">Custom Fields</h3>
              <button class="diag-btn" id="btn-add-custom-field" style="font-size:11px; padding:2px 8px;">+ Add Field</button>
            </div>
            <div id="custom-fields-add-form" style="display:none; background:#1b2838; border:1px solid #3d5a2e; border-radius:6px; padding:10px; margin-bottom:8px;">
              <div style="display:flex; gap:8px; align-items:center;">
                <input type="text" id="cf-new-name" placeholder="Field name" maxlength="100" style="flex:1; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:6px 10px; border-radius:4px; font-size:13px;" />
                <input type="text" id="cf-new-value" placeholder="Value" maxlength="2000" style="flex:2; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:6px 10px; border-radius:4px; font-size:13px;" />
                <button class="diag-btn" id="btn-save-custom-field" style="font-size:12px;">Save</button>
                <button class="diag-btn" id="btn-cancel-custom-field" style="font-size:12px; background:none; border-color:#2a475e; color:#8f98a0;">Cancel</button>
              </div>
            </div>
            <div id="custom-fields-grid" class="stats-row" style="margin-bottom:0;"></div>
          </div>

          <!-- Two-column layout: tools + chat -->
          <div style="display:grid; grid-template-columns:1fr 400px; gap:20px;">
            <!-- Left column: Diagnostics, File Browser, Scripts -->
            <div>
              <h2 class="section-title">Diagnostics</h2>
              <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:16px; margin-bottom:20px;">
                <div class="diag-actions" id="diag-actions" style="margin-bottom:12px;">
                  <button class="diag-btn" data-diag="all">Run All</button>
                  <button class="diag-btn" data-diag="cpu">CPU</button>
                  <button class="diag-btn" data-diag="memory">Memory</button>
                  <button class="diag-btn" data-diag="disk">Disk</button>
                  <button class="diag-btn" data-diag="network">Network</button>
                </div>
                <div id="detail-diagnostics"></div>
              </div>

              <h2 class="section-title" id="sys-tools-heading" style="cursor:pointer; user-select:none;" title="Click to expand/collapse">System Tools <span id="sys-tools-toggle" style="font-size:14px; color:#8f98a0;">&#x25BC;</span></h2>
              <input type="hidden" id="sys-tools-section-loaded" value="" />
              <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:16px; margin-bottom:20px;">
                <div id="sys-tools-content" style="display:none;">
                <div class="sys-tools-tabs">
                  <button class="sys-tools-tab active" data-tab="processes">Processes</button>
                  <button class="sys-tools-tab" data-tab="services">Services</button>
                  <button class="sys-tools-tab" data-tab="eventlog">Event Log</button>
                </div>

                <!-- Processes Panel -->
                <div id="sys-panel-processes" class="sys-tools-panel active">
                  <div class="sys-filter-bar">
                    <button class="diag-btn" id="btn-refresh-processes">Refresh</button>
                    <label class="toggle-label" style="font-size:12px; color:#8f98a0;">
                      <span class="toggle-switch"><input type="checkbox" id="proc-auto-refresh"><span class="toggle-track"></span></span> Auto-refresh (10s)
                    </label>
                    <span id="proc-count" style="font-size:12px; color:#8f98a0; margin-left:auto;"></span>
                  </div>
                  <div id="proc-table-container" style="max-height:400px; overflow-y:auto;">
                    <div style="color:#8f98a0; font-size:13px;">Click Refresh to load processes</div>
                  </div>
                </div>

                <!-- Services Panel -->
                <div id="sys-panel-services" class="sys-tools-panel">
                  <div class="sys-filter-bar">
                    <button class="diag-btn" id="btn-refresh-services">Refresh</button>
                    <select id="svc-filter">
                      <option value="">All</option>
                      <option value="running">Running</option>
                      <option value="stopped">Stopped</option>
                    </select>
                    <input type="text" id="svc-search" placeholder="Search services..." style="width:180px;" />
                    <span id="svc-count" style="font-size:12px; color:#8f98a0; margin-left:auto;"></span>
                  </div>
                  <div id="svc-table-container" style="max-height:400px; overflow-y:auto;">
                    <div style="color:#8f98a0; font-size:13px;">Click Refresh to load services</div>
                  </div>
                </div>

                <!-- Event Log Panel -->
                <div id="sys-panel-eventlog" class="sys-tools-panel">
                  <div class="sys-filter-bar">
                    <select id="evt-log-name">
                      <option value="Application">Application</option>
                      <option value="Security">Security</option>
                      <option value="System">System</option>
                    </select>
                    <select id="evt-level">
                      <option value="error">Errors</option>
                      <option value="warning">Warnings</option>
                      <option value="error,warning">Errors + Warnings</option>
                      <option value="information">Information</option>
                    </select>
                    <select id="evt-hours">
                      <option value="24">Last 24h</option>
                      <option value="48">Last 48h</option>
                      <option value="72">Last 3 days</option>
                      <option value="168">Last 7 days</option>
                    </select>
                    <button class="diag-btn" id="btn-query-eventlog">Query</button>
                    <button class="sys-filter-bar preset-btn" id="btn-preset-errors-24h">Errors 24h</button>
                    <button class="sys-filter-bar preset-btn" id="btn-preset-critical-7d">Critical 7d</button>
                    <input type="text" id="evt-search" placeholder="Search ID, source, message..." style="width:200px;" />
                    <span id="evt-count" style="font-size:12px; color:#8f98a0; margin-left:auto;"></span>
                  </div>
                  <div id="evt-table-container" style="max-height:400px; overflow-y:auto;">
                    <div style="color:#8f98a0; font-size:13px;">Select filters and click Query</div>
                  </div>
                </div>
                </div><!-- end sys-tools-content -->
              </div>

              <h2 class="section-title" id="file-browser-heading" style="cursor:pointer; user-select:none;" title="Click to expand/collapse">File Browser <span id="file-section-toggle" style="font-size:14px; color:#8f98a0;">&#x25BC;</span></h2>
              <input type="hidden" id="file-section-loaded" value="" />
              <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:16px; margin-bottom:20px;">
                <div id="file-section-content" style="display:none;">
                <!-- Action toolbar (shown when files are selected) -->
                <div id="file-action-toolbar" style="display:none; background:#0e1621; border:1px solid #2a475e; border-radius:6px; padding:8px 12px; margin-bottom:10px; flex-wrap:wrap; align-items:center; gap:8px;">
                  <span id="file-selection-count" style="font-size:13px; color:#8f98a0; margin-right:4px;">0 items selected</span>
                  <button class="diag-btn" id="file-action-copy" style="font-size:12px; padding:4px 10px;">Copy</button>
                  <button class="diag-btn" id="file-action-cut" style="font-size:12px; padding:4px 10px;">Cut</button>
                  <button id="file-paste-btn" class="diag-btn" style="font-size:12px; padding:4px 10px;" disabled>Paste</button>
                  <button class="diag-btn" id="file-action-delete" style="font-size:12px; padding:4px 10px; background:#4a1919; color:#ef5350;">Delete</button>
                  <button class="diag-btn" id="file-action-copy-paths" style="font-size:12px; padding:4px 10px;">Copy Paths</button>
                  <button class="diag-btn" id="file-properties-btn" style="font-size:12px; padding:4px 10px;">Properties</button>
                  <button class="diag-btn" id="file-action-upload" style="font-size:12px; padding:4px 10px;">Upload</button>
                  <button class="diag-btn" id="file-action-download" style="font-size:12px; padding:4px 10px;">Download</button>
                </div>
                <input type="file" id="file-upload-input" multiple style="display:none;" />
                <!-- Breadcrumb navigation bar -->
                <div id="file-breadcrumb" style="display:flex; align-items:center; gap:4px; margin-bottom:12px; padding:8px 12px; background:#0e1621; border-radius:6px; flex-wrap:wrap; min-height:36px;">
                  <span id="breadcrumb-drives" style="color:#66c0f4; cursor:pointer; font-size:14px;" title="Drives">&#x1F4BB; Drives</span>
                </div>
                <!-- File listing area -->
                <div id="file-browser-area" style="min-height:200px; max-height:500px; overflow-y:auto;"></div>
                <!-- Properties panel -->
                <div id="file-properties-panel" style="display:none; margin-top:12px; background:#0a0f14; border:1px solid #2a475e; border-radius:6px; padding:12px;">
                  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                    <span style="font-size:13px; font-weight:600; color:#c7d5e0;">File Properties</span>
                    <button id="btn-close-file-properties" style="background:#2a475e; color:#c7d5e0; border:none; border-radius:4px; padding:3px 10px; cursor:pointer; font-size:12px;">&#x2715;</button>
                  </div>
                  <div id="file-properties-content" style="font-size:12px; font-family:monospace; color:#a8b4c0; line-height:1.6;"></div>
                </div>
                </div><!-- end file-section-content -->
              </div>

              <h2 class="section-title">Remote Scripts</h2>
              <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:16px; margin-bottom:20px;">
                <div class="script-select" style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
                  <select id="script-library-select" style="flex:1; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px;">
                    <option value="">-- Select from library --</option>
                  </select>
                  <button class="diag-btn" id="btn-run-library-script">Run</button>
                </div>
                <details style="margin-top:8px;">
                  <summary style="cursor:pointer; font-size:13px; color:#8f98a0;">Ad-hoc Script</summary>
                  <div style="margin-top:8px;">
                    <textarea id="adhoc-script" class="script-textarea" placeholder="Enter PowerShell script..." style="width:100%; min-height:80px; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; font-family:monospace; font-size:13px; resize:vertical; box-sizing:border-box;"></textarea>
                    <select id="adhoc-os" style="margin-top:6px; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:6px 8px; border-radius:4px; font-size:12px;">
                      <option value="windows">Windows</option>
                      <option value="windows-server">Windows Server</option>
                      <option value="macos">macOS</option>
                      <option value="linux">Linux</option>
                    </select>
                    <button class="diag-btn" id="btn-generate-script-adhoc" style="margin-top:6px; font-size:12px;">&#10022; Generate with AI</button>
                    <div style="display:flex; gap:8px; margin-top:8px; align-items:center;">
                      <label class="toggle-label" style="font-size:12px; color:#8f98a0;">
                        <span class="toggle-switch"><input type="checkbox" id="adhoc-elevation"><span class="toggle-track"></span></span> Admin
                      </label>
                      <input type="number" id="adhoc-timeout" value="60" min="5" max="300" style="width:60px; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:4px 6px; border-radius:4px; font-size:12px;" />
                      <span style="font-size:11px; color:#8f98a0;">sec</span>
                      <span style="flex:1;"></span>
                      <button class="diag-btn" id="btn-run-adhoc-script">Execute</button>
                    </div>
                  </div>
                </details>
                <details style="margin-top:10px;">
                  <summary style="cursor:pointer; font-size:12px; color:#3d5a2e;">Auto-populate Custom Fields from scripts</summary>
                  <div style="margin-top:6px; padding:8px 10px; background:#0e1621; border:1px solid #2a475e; border-left:3px solid #3d5a2e; border-radius:4px; font-size:12px; color:#8f98a0; line-height:1.6;">
                    Scripts can auto-populate the Custom Fields section above by printing a special marker line:<br>
                    <code style="display:block; margin:6px 0; padding:6px 8px; background:#0a0f14; border-radius:3px; color:#66c0f4; font-size:11px; word-break:break-all;">POCKET_IT_FIELDS:{"Department":"Engineering","Asset Tag":"A1234","Warranty":"2027-03"}</code>
                    <span style="color:#616161;">The JSON after <code style="color:#8f98a0;">POCKET_IT_FIELDS:</code> is parsed and upserted as custom fields. Multiple marker lines are supported. Source shows as "script" in field cards.</span>
                  </div>
                </details>
                <div id="script-output-area" style="margin-top:12px;"></div>
              </div>

              <!-- Device Notes -->
              <h2 class="section-title" id="device-notes-heading" style="cursor:pointer; user-select:none;" title="Click to expand/collapse">Device Notes <span id="device-notes-count" style="font-size:13px; color:#8f98a0;"></span> <span id="device-notes-toggle" style="font-size:14px; color:#8f98a0;">&#x25BC;</span></h2>
              <div id="device-notes-section" style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:16px; margin-bottom:20px;">
                <div id="device-notes-content">
                  <div style="display:flex; gap:8px; margin-bottom:12px;">
                    <input type="text" id="device-note-input" placeholder="Add a note..." maxlength="5000" style="flex:1; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px 12px; border-radius:4px; font-size:13px;" />
                    <button class="diag-btn" id="btn-add-device-note" style="background:#66c0f4; color:#1b2838; font-weight:600;">Add Note</button>
                  </div>
                  <div id="device-notes-list"></div>
                </div>
              </div>

              <!-- Device Passwords -->
              <h2 class="section-title" id="device-passwords-heading" style="cursor:pointer; user-select:none; margin-top:20px;" title="Click to expand/collapse">
                Passwords <span id="device-passwords-count" style="font-size:13px; color:#8f98a0;"></span>
                <span id="device-passwords-toggle" style="font-size:12px; color:#8f98a0; float:right;">&#x25BC;</span>
              </h2>
              <input type="hidden" id="device-passwords-section-loaded" value="" />
              <div id="device-passwords-section" style="display:none; background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:12px; margin-bottom:20px;">
                <div id="device-passwords-list"><div style="color:#8f98a0; font-size:13px;">Loading...</div></div>
              </div>

              <!-- Client Info (read-only) -->
              <h2 class="section-title" id="client-info-heading" style="cursor:pointer; user-select:none; margin-top:20px;" title="Click to expand/collapse">
                Client Info <span id="client-info-toggle" style="font-size:12px; color:#8f98a0; float:right;">&#x25BC;</span>
              </h2>
              <input type="hidden" id="client-info-section-loaded" value="" />
              <div id="client-info-section" style="display:none; background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:12px; margin-bottom:20px;">
                <div id="client-info-content">
                  <div style="color:#8f98a0; font-size:13px;">Loading...</div>
                </div>
              </div>

              <!-- Device Tickets -->
              <div class="section-block" style="margin-top:16px;">
                <h4 style="margin:0 0 10px 0;font-size:13px;color:#8f98a0;text-transform:uppercase;letter-spacing:0.5px;">Tickets</h4>
                <div id="device-tickets-list"></div>
                <button id="btn-device-view-all-tickets" style="margin-top:8px;background:none;border:1px solid #2a475e;color:#66c0f4;padding:4px 10px;border-radius:4px;font-size:12px;cursor:pointer;">View all tickets →</button>
              </div>
            </div>

            <!-- Right column: Live Chat + AI Guidance -->
            <div>
              <div style="display:flex; gap:0; margin-bottom:0;">
                <button class="diag-btn" id="chat-tab-user" data-tab="user" style="border-radius:6px 6px 0 0; background:#1a3a5c; border-bottom:2px solid #66c0f4;">User Chat</button>
                <button class="diag-btn" id="chat-tab-guidance" data-tab="guidance" style="border-radius:6px 6px 0 0; border-bottom:2px solid transparent;">AI Guidance</button>
              </div>
              <!-- User Chat panel -->
              <div id="chat-panel-user" style="background:#1b2838; border:1px solid #2a475e; border-radius:0 8px 8px 8px; padding:16px; display:flex; flex-direction:column; height:480px;">
                <div id="chat-user-label" style="font-size:11px;color:#8f98a0;margin-bottom:6px;min-height:14px;"></div>
                <div class="chat-area" id="detail-chat" style="flex:1; overflow-y:auto; margin-bottom:12px;"></div>
                <div style="display:flex; gap:8px;">
                  <input type="text" id="detail-chat-input" placeholder="Send message to user..." style="flex:1; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px 12px; border-radius:4px;" />
                  <button class="diag-btn" id="btn-send-chat" style="background:#66c0f4; color:#1b2838; font-weight:600;">Send</button>
                </div>
              </div>
              <!-- AI Guidance panel -->
              <div id="chat-panel-guidance" style="display:none; background:#1b2838; border:1px solid #2a475e; border-radius:0 8px 8px 8px; padding:16px; flex-direction:column; height:480px;">
                <div class="chat-area" id="guidance-chat" style="flex:1; overflow-y:auto; margin-bottom:12px;"></div>
                <div style="display:flex; gap:8px;">
                  <input type="text" id="guidance-chat-input" placeholder="Instruct AI (e.g., 'check disk space', 'restart spooler')..." style="flex:1; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px 12px; border-radius:4px;" />
                  <button class="diag-btn" id="btn-send-guidance" style="background:#e65100; color:#fff; font-weight:600;">Send</button>
                </div>
                <div style="display:flex; gap:8px; margin-top:6px;">
                  <button class="diag-btn" id="btn-clear-guidance" style="font-size:11px; padding:3px 8px;">Clear Context</button>
                  <span id="guidance-status" style="font-size:11px; color:#8f98a0; align-self:center;"></span>
                </div>
              </div>
            </div>
          </div>

          <!-- Full-width: Remote Desktop -->
          <h2 class="section-title" style="margin-top:20px;">Remote Desktop</h2>
          <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:16px; margin-bottom:20px;">
            <div id="desktop-controls" style="margin-bottom:10px; display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
              <button id="btn-start-desktop" class="diag-btn">Connect</button>
              <button id="btn-stop-desktop" class="diag-btn" disabled style="background:#4a1919; color:#ef5350;">Disconnect</button>
              <button class="diag-btn" id="btn-popout-desktop" title="Open in new tab">&#8599; New Tab</button>
              <span id="desktop-status" style="color:#8f98a0; font-size:13px;">Not connected</span>
              <span style="flex:1;"></span>
              <label style="font-size:12px; color:#8f98a0;">Quality:</label>
              <select id="desktop-quality" style="background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:4px 8px; border-radius:4px; font-size:12px;">
                <option value="30">Low</option>
                <option value="50" selected>Medium</option>
                <option value="75">High</option>
              </select>
              <label style="font-size:12px; color:#8f98a0;">FPS:</label>
              <select id="desktop-fps" style="background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:4px 8px; border-radius:4px; font-size:12px;">
                <option value="5">5</option>
                <option value="10" selected>10</option>
                <option value="15">15</option>
                <option value="24">24</option>
              </select>
              <label style="font-size:12px; color:#8f98a0;">Scale:</label>
              <select id="desktop-scale" style="background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:4px 8px; border-radius:4px; font-size:12px;">
                <option value="0.25">25%</option>
                <option value="0.5" selected>50%</option>
                <option value="0.75">75%</option>
                <option value="1.0">100%</option>
              </select>
            </div>
            <div id="desktop-viewer" style="display:none; position:relative; background:#000; border-radius:4px; overflow:hidden; cursor:crosshair;">
              <canvas id="desktop-canvas" style="width:100%; display:block;"></canvas>
            </div>
          </div>

          <!-- Full-width: Remote Terminal -->
          <h2 class="section-title" style="margin-top:20px;">Remote Terminal</h2>
          <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:16px; margin-bottom:20px;">
            <div id="terminal-controls" style="margin-bottom:10px; display:flex; align-items:center; gap:10px;">
              <button id="btn-start-terminal" class="diag-btn">Open Terminal</button>
              <button id="btn-stop-terminal" class="diag-btn" disabled style="background:#4a1919; color:#ef5350;">Disconnect</button>
              <span id="terminal-status" style="color:#8f98a0; font-size:13px;">Not connected</span>
            </div>
            <div id="terminal-container" style="display:none; height:400px;"></div>
          </div>

          <!-- Full-width: Activity History -->
          <h2 class="section-title" style="margin-top:20px;">Activity History</h2>
          <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:16px; margin-bottom:20px;">
            <div class="activity-filter-bar">
              <select id="activity-category-filter" style="min-width:160px;">
                <option value="">All</option>
                <option value="alert_acknowledged,alert_resolved">Alerts</option>
                <option value="desktop_session_started,desktop_session_ended">Desktop</option>
                <option value="diagnostic_requested,diagnostic_completed">Diagnostics</option>
                <option value="file_browse_requested,file_browse_completed,file_read_requested,file_read_completed">Files</option>
                <option value="remediation_requested,remediation_executed,auto_remediation_triggered">Remediation</option>
                <option value="script_requested,script_completed">Scripts</option>
                <option value="system_tool_requested,system_tool_completed">System Tools</option>
                <option value="terminal_session_started,terminal_session_ended">Terminal</option>
                <option value="ticket_created,ticket_updated,ticket_comment_added">Tickets</option>
                <option value="device_note_added,device_note_deleted,custom_fields_updated,custom_field_deleted">Notes/Fields</option>
              </select>
              <label style="font-size:12px; color:#8f98a0;">From</label>
              <input type="date" id="activity-date-from" />
              <label style="font-size:12px; color:#8f98a0;">To</label>
              <input type="date" id="activity-date-to" />
              <button class="diag-btn" id="btn-activity-apply">Apply</button>
              <button class="diag-btn" id="btn-activity-reset" style="background:none; border-color:#2a475e; color:#8f98a0;">Reset</button>
            </div>
            <div style="max-height:500px; overflow-y:auto;" id="activity-table-wrapper">
              <table class="activity-table">
                <thead>
                  <tr>
                    <th style="width:160px;">Timestamp</th>
                    <th style="width:180px;">Action</th>
                    <th style="width:120px;">Actor</th>
                    <th>Details</th>
                  </tr>
                </thead>
                <tbody id="activity-tbody">
                  <tr><td colspan="4" style="color:#8f98a0; text-align:center; padding:24px;">No activity loaded.</td></tr>
                </tbody>
              </table>
            </div>
            <div id="activity-load-more" style="display:none; margin-top:12px; text-align:center;">
              <button class="diag-btn" id="btn-activity-load-more">Load More</button>
            </div>
          </div>

          <!-- Danger zone -->
          <div style="padding-top:16px; border-top:1px solid #2a475e; display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
            <button class="diag-btn" id="btn-move-device" style="font-size:12px; padding:4px 12px;">Move to Client</button>
            <button class="diag-btn" id="btn-remove-device" style="background:#4a1919; color:#ef5350;">Remove Device</button>
            <span style="font-size:12px; color:#8f98a0;">Removes device and all its data. Device must re-enroll.</span>
          </div>
        </div>

        <!-- Tickets page -->
        <div class="page" id="page-tickets">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                <h2 class="section-title" style="margin-bottom:0;">Support Tickets</h2>
                <button class="diag-btn" id="btn-new-ticket" style="background:#66c0f4; color:#1b2838; font-weight:600; padding:8px 16px;">+ New Ticket</button>
            </div>
            <!-- Create ticket form -->
            <div id="create-ticket-form" class="client-form" style="display:none; margin-bottom:20px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                    <span style="font-weight:600; color:#c7d5e0;">New Support Ticket</span>
                    <button class="diag-btn" id="btn-cancel-ticket-form" style="font-size:12px; padding:4px 10px;">Cancel</button>
                </div>
                <div style="display:flex; gap:16px; flex-wrap:wrap;">
                    <div style="flex:1; min-width:250px;">
                        <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Title *</label>
                        <input type="text" id="new-ticket-title" placeholder="Brief description of the issue" style="width:100%; box-sizing:border-box;">
                    </div>
                    <div style="min-width:200px; position:relative;">
                        <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Device *</label>
                        <input type="hidden" id="new-ticket-device" value="">
                        <div style="position:relative;">
                            <input type="text" id="new-ticket-device-search" placeholder="Search device..." autocomplete="off"
                                style="width:100%; box-sizing:border-box;">
                            <div id="new-ticket-device-dropdown" style="display:none; position:absolute; top:100%; left:0; right:0; z-index:50; max-height:180px; overflow-y:auto; background:#0f1923; border:1px solid #2a475e; border-top:none; border-radius:0 0 6px 6px; box-shadow:0 4px 12px rgba(0,0,0,0.4);"></div>
                        </div>
                    </div>
                </div>
                <div style="display:flex; gap:16px; margin-top:12px; flex-wrap:wrap;">
                    <div style="min-width:120px;">
                        <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Priority</label>
                        <select id="new-ticket-priority" style="width:100%; padding:8px 10px; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; border-radius:6px; font-size:13px;">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                            <option value="critical">Critical</option>
                        </select>
                    </div>
                    <div style="min-width:120px;">
                        <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Category</label>
                        <input type="text" id="new-ticket-category" placeholder="e.g. Hardware, Network" style="width:100%; box-sizing:border-box;">
                    </div>
                </div>
                <div style="margin-top:12px;">
                    <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Description</label>
                    <textarea id="new-ticket-description" placeholder="Detailed description of the issue, steps to reproduce, etc." style="width:100%; min-height:80px; box-sizing:border-box; resize:vertical;"></textarea>
                </div>
                <div style="margin-top:12px; display:flex; gap:8px;">
                    <button class="diag-btn" id="btn-submit-ticket" style="background:#66c0f4; color:#1b2838; font-weight:600; padding:8px 20px;">Create Ticket</button>
                    <button class="diag-btn" id="btn-cancel-ticket-form2">Cancel</button>
                </div>
            </div>
            <ul class="ticket-list" id="ticket-list">
                <div class="empty-state">No tickets yet.</div>
            </ul>
        </div>


        <!-- Alerts page -->
        <div class="page" id="page-alerts">
            <div class="stats-row">
                <div class="stat-card">
                    <div class="value" id="alert-stat-active" style="color: #ef5350;">0</div>
                    <div class="label">Active Alerts</div>
                </div>
                <div class="stat-card">
                    <div class="value" id="alert-stat-critical" style="color: #d50000;">0</div>
                    <div class="label">Critical</div>
                </div>
                <div class="stat-card">
                    <div class="value" id="alert-stat-warning" style="color: #ffa726;">0</div>
                    <div class="label">Warning</div>
                </div>
            </div>

            <div class="alert-filter-row" id="alert-filter-row">
                <button class="alert-filter-btn active" data-filter="active">Active</button>
                <button class="alert-filter-btn" data-filter="all">All History</button>
            </div>

            <h2 class="section-title">Alerts</h2>
            <ul class="alert-list" id="alert-list">
                <div class="empty-state">No alerts.</div>
            </ul>

            <div style="margin-top: 32px;">
                <h2 class="section-title">Threshold Configuration</h2>
                <div class="alert-section">
                    <table class="threshold-table" id="threshold-table">
                        <thead>
                            <tr>
                                <th>Check Type</th>
                                <th>Field</th>
                                <th>Condition</th>
                                <th>Severity</th>
                                <th>Consecutive</th>
                                <th>Enabled</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="threshold-tbody"></tbody>
                    </table>
                </div>
            </div>

            <div style="margin-top: 24px;">
                <h2 class="section-title">Notification Channels</h2>
                <div class="alert-section">
                    <table class="channel-table" id="channel-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Enabled</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="channel-tbody"></tbody>
                    </table>
                    <button class="diag-btn" id="btn-show-add-channel" style="margin-top: 12px;">Add Channel</button>
                    <div id="add-channel-form" style="display: none; margin-top: 12px; background: #0f1923; border: 1px solid #2a475e; border-radius: 6px; padding: 16px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                            <input type="text" id="channel-name" placeholder="Channel name" style="background:#1b2838; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; font-size:13px;" />
                            <select id="channel-type" style="background:#1b2838; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; font-size:13px;">
                                <option value="slack">Slack</option>
                                <option value="teams">Teams</option>
                                <option value="webhook">Webhook</option>
                            </select>
                        </div>
                        <input type="text" id="channel-url" placeholder="Webhook URL" style="width:100%; background:#1b2838; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; font-size:13px; margin-bottom:8px;" />
                        <div style="display: flex; gap: 8px;">
                            <button class="diag-btn" id="btn-save-channel">Save</button>
                            <button class="diag-btn" id="btn-cancel-channel">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 24px;">
                <h2 class="section-title">Auto-Remediation Policies</h2>
                <div class="alert-section">
                    <p style="font-size: 12px; color: #8f98a0; margin-bottom: 12px;">When an alert threshold is triggered, auto-remediation can automatically execute a fix action.</p>
                    <table class="policy-table" id="policy-table">
                        <thead>
                            <tr>
                                <th>Threshold</th>
                                <th>Action</th>
                                <th>Parameter</th>
                                <th>Cooldown</th>
                                <th>Consent</th>
                                <th>Enabled</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="policy-tbody"></tbody>
                    </table>
                    <button class="diag-btn" id="btn-show-add-policy" style="margin-top: 12px;">Add Policy</button>
                    <div id="add-policy-form" style="display:none; margin-top:12px; background:#0f1923; border:1px solid #2a475e; border-radius:6px; padding:16px;">
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:8px;">
                            <select id="policy-threshold" style="background:#1b2838; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; font-size:13px;"></select>
                            <select id="policy-action" style="background:#1b2838; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; font-size:13px;">
                                <option value="clear_browser_cache">Clear Browser Cache</option>
                                <option value="clear_temp">Clear Temp Files</option>
                                <option value="flush_dns">Flush DNS</option>
                                <option value="repair_network">Repair Network</option>
                                <option value="restart_service">Restart Service</option>
                                <option value="restart_spooler">Restart Spooler</option>
                            </select>
                        </div>
                        <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; margin-bottom:8px;">
                            <input type="text" id="policy-parameter" placeholder="Parameter (optional)" style="background:#1b2838; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; font-size:13px;" />
                            <input type="number" id="policy-cooldown" placeholder="Cooldown (min)" value="30" style="background:#1b2838; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; font-size:13px;" />
                            <label class="toggle-label">
                                <span class="toggle-switch"><input type="checkbox" id="policy-consent" checked><span class="toggle-track"></span></span> Require consent
                            </label>
                        </div>
                        <div style="display:flex; gap:8px;">
                            <button class="diag-btn" id="btn-save-policy">Save</button>
                            <button class="diag-btn" id="btn-cancel-policy">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clients page (admin only) -->
        <div class="page" id="page-clients">
            <h2 class="section-title">Client Management</h2>
            <div class="client-form" id="client-create-form">
                <h3 style="margin-bottom: 12px; color: #c7d5e0;">Add New Client</h3>
                <label>Name *</label>
                <input type="text" id="new-client-name" placeholder="e.g. Acme Corp">
                <label>Contact Name</label>
                <input type="text" id="new-client-contact" placeholder="e.g. John Smith">
                <label>Contact Email</label>
                <input type="email" id="new-client-email" placeholder="e.g. john@acme.com">
                <label>Notes</label>
                <textarea id="new-client-notes" rows="2" placeholder="Optional notes..."></textarea>
                <button class="diag-btn" id="btn-create-client">Create Client</button>
            </div>
            <table class="client-table">
                <thead><tr><th>Name</th><th>Devices</th><th>Contact</th><th>Created</th><th>Actions</th></tr></thead>
                <tbody id="client-table-body"></tbody>
            </table>
            <div id="client-users-panel" style="display:none; margin-top: 24px; background: #1b2838; border: 1px solid #2a475e; border-radius: 8px; padding: 20px;">
                <h3 style="color: #c7d5e0; margin-bottom: 12px;">Assigned Technicians — <span id="client-users-title"></span></h3>
                <div id="client-users-list"></div>
                <div style="margin-top: 12px;">
                    <select id="assign-user-select" style="padding: 6px 10px; background: #0f1923; border: 1px solid #2a475e; border-radius: 6px; color: #c7d5e0;"></select>
                    <button class="diag-btn" id="btn-assign-user" style="margin-left: 8px;">Assign</button>
                </div>
            </div>
            <div id="client-detail-panel" style="display:none; margin-top: 24px; background: #1b2838; border: 1px solid #2a475e; border-radius: 8px; padding: 20px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                    <h3 style="color:#c7d5e0;">Client Details — <span id="client-detail-title"></span></h3>
                    <button class="diag-btn" id="btn-close-client-detail" style="font-size:11px;padding:4px 8px;">Close</button>
                </div>

                <!-- Custom Fields Section -->
                <div style="margin-bottom:20px;">
                    <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
                        <h4 style="color:#c7d5e0; margin:0;">Custom Fields</h4>
                        <button class="diag-btn" id="btn-add-client-field" style="font-size:11px; padding:2px 8px;">+ Add Field</button>
                    </div>
                    <div id="client-field-add-form" style="display:none; margin-bottom:12px; padding:10px; background:#0f1923; border-radius:6px; border:1px solid #2a475e;">
                        <div style="display:flex; gap:8px; align-items:end;">
                            <div style="flex:1;">
                                <label style="font-size:11px; color:#8f98a0; display:block; margin-bottom:2px;">Field Name</label>
                                <input type="text" id="client-field-name" maxlength="100" placeholder="e.g. SLA Tier" style="width:100%;">
                            </div>
                            <div style="flex:1;">
                                <label style="font-size:11px; color:#8f98a0; display:block; margin-bottom:2px;">Value</label>
                                <input type="text" id="client-field-value" maxlength="2000" placeholder="e.g. Gold" style="width:100%;">
                            </div>
                            <button class="diag-btn" id="btn-save-client-field" style="font-size:11px; padding:4px 10px;">Save</button>
                            <button class="diag-btn" id="btn-cancel-client-field" style="font-size:11px; padding:4px 10px;">Cancel</button>
                        </div>
                    </div>
                    <div id="client-custom-fields-list" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(220px, 1fr)); gap:8px;">
                        <div style="color:#8f98a0; font-size:13px;">No custom fields.</div>
                    </div>
                </div>

                <!-- Notes Section -->
                <div>
                    <h4 style="color:#c7d5e0; margin:0 0 8px 0;">Notes <span id="client-notes-count" style="font-size:12px; color:#8f98a0;"></span></h4>
                    <div style="display:flex; gap:8px; margin-bottom:12px;">
                        <input type="text" id="client-note-input" placeholder="Add a note..." maxlength="5000" style="flex:1;">
                        <button class="diag-btn" id="btn-add-client-note">Add Note</button>
                    </div>
                    <div id="client-notes-list"></div>
                </div>
            </div>
        </div>

        <!-- Reports page -->
        <div class="page" id="page-reports">
  <!-- Time range selector -->
  <div style="display:flex; align-items:center; gap:12px; margin-bottom:20px; flex-wrap:wrap;">
    <span style="color:#8f98a0; font-size:13px;">Time Range:</span>
    <button class="diag-btn report-range-btn active" data-days="7">7 Days</button>
    <button class="diag-btn report-range-btn" data-days="30">30 Days</button>
    <button class="diag-btn report-range-btn" data-days="90">90 Days</button>
    <div style="flex:1;"></div>
    <button class="diag-btn" id="btn-export-csv" style="background:#2a475e;">Export CSV</button>
    <button class="diag-btn" id="btn-export-pdf" style="background:#2a475e;">Export PDF</button>
  </div>

  <!-- Fleet Health Trend -->
  <h2 class="section-title">Fleet Health Trend</h2>
  <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:20px; margin-bottom:20px;">
    <canvas id="chart-fleet-health" height="80"></canvas>
  </div>

  <!-- Alert Summary -->
  <h2 class="section-title">Alert Summary</h2>
  <div class="stats-row" id="alert-summary-stats" style="margin-bottom:16px;">
    <div class="stat-card" data-page="alerts"><div class="value" id="stat-alert-total">0</div><div class="label">Total Alerts</div></div>
    <div class="stat-card" data-page="alerts"><div class="value" id="stat-alert-active" style="color:#ef5350;">0</div><div class="label">Active</div></div>
    <div class="stat-card" data-page="alerts"><div class="value" id="stat-alert-resolved" style="color:#66bb6a;">0</div><div class="label">Resolved</div></div>
    <div class="stat-card" data-page="alerts"><div class="value" id="stat-alert-mttr">-</div><div class="label">MTTR (hours)</div></div>
  </div>
  <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:20px;">
    <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:20px;">
      <canvas id="chart-alerts-per-day" height="100"></canvas>
    </div>
    <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:20px;">
      <canvas id="chart-alerts-by-severity" height="100"></canvas>
    </div>
  </div>

  <!-- Ticket Summary -->
  <h2 class="section-title">Ticket Summary</h2>
  <div class="stats-row" id="ticket-summary-stats" style="margin-bottom:16px;">
    <div class="stat-card" data-page="tickets"><div class="value" id="stat-ticket-total">0</div><div class="label">Total Tickets</div></div>
    <div class="stat-card" data-page="tickets"><div class="value" id="stat-ticket-open" style="color:#ffa726;">0</div><div class="label">Open</div></div>
    <div class="stat-card" data-page="tickets"><div class="value" id="stat-ticket-resolved" style="color:#66bb6a;">0</div><div class="label">Resolved</div></div>
    <div class="stat-card" data-page="tickets"><div class="value" id="stat-ticket-avgres">-</div><div class="label">Avg Resolution (hours)</div></div>
  </div>
  <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:20px; margin-bottom:20px;">
    <canvas id="chart-tickets-per-day" height="80"></canvas>
  </div>

  <!-- Device Drill-down -->
  <h2 class="section-title">Device Drill-down</h2>
  <div style="display:flex; gap:12px; align-items:center; margin-bottom:12px;">
    <select id="report-device-select" style="background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px 12px; border-radius:4px; min-width:200px;">
      <option value="">Select a device...</option>
    </select>
    <select id="report-metric-select" style="background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px 12px; border-radius:4px;">
      <option value="cpu">CPU Usage</option>
      <option value="disk">Disk Usage</option>
      <option value="memory">Memory Usage</option>
    </select>
    <button class="diag-btn" id="btn-load-device-metrics">Load</button>
  </div>
  <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:20px; margin-bottom:20px;">
    <canvas id="chart-device-metrics" height="80"></canvas>
    <div id="device-metrics-empty" class="empty-state" style="display:none;">Select a device and metric to view trends</div>
  </div>

  <!-- Scheduled Reports -->
  <h2 class="section-title">Scheduled Reports</h2>
  <div style="margin-bottom:12px;">
    <button class="diag-btn" id="btn-show-schedule-form" style="background:#66c0f4; color:#1b2838; font-weight:600;">+ New Schedule</button>
  </div>
  <div id="schedule-form" style="display:none; background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:20px; margin-bottom:16px;">
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
      <div>
        <label style="color:#8f98a0; font-size:12px; display:block; margin-bottom:4px;">Name</label>
        <input type="text" id="sched-name" style="background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; width:100%; box-sizing:border-box;">
      </div>
      <div>
        <label style="color:#8f98a0; font-size:12px; display:block; margin-bottom:4px;">Report Type</label>
        <select id="sched-type" style="background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; width:100%; box-sizing:border-box;">
          <option value="alert_summary">Alert Summary</option>
          <option value="device_metrics">Device Metrics</option>
          <option value="fleet_health">Fleet Health</option>
          <option value="ticket_summary">Ticket Summary</option>
        </select>
      </div>
      <div>
        <label style="color:#8f98a0; font-size:12px; display:block; margin-bottom:4px;">Cron Schedule</label>
        <input type="text" id="sched-cron" placeholder="0 8 * * 1" style="background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; width:100%; box-sizing:border-box;">
        <span style="color:#8f98a0; font-size:11px;">e.g. 0 8 * * 1 = Mon 8am</span>
      </div>
      <div>
        <label style="color:#8f98a0; font-size:12px; display:block; margin-bottom:4px;">Format</label>
        <select id="sched-format" style="background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:8px; border-radius:4px; width:100%; box-sizing:border-box;">
          <option value="csv">CSV</option>
          <option value="pdf">PDF</option>
        </select>
      </div>
    </div>
    <div style="margin-top:12px; display:flex; gap:8px; justify-content:flex-end;">
      <button class="diag-btn" id="btn-cancel-schedule">Cancel</button>
      <button class="diag-btn" id="btn-save-schedule" style="background:#66c0f4; color:#1b2838; font-weight:600;">Save</button>
    </div>
  </div>
  <div id="schedules-list"></div>

  <!-- Report History -->
  <h2 class="section-title" style="margin-top:24px;">Report History</h2>
  <div id="report-history-list"></div>
        </div>

        <!-- Updates page -->
        <div class="page" id="page-updates">
            <h2 class="section-title">Update Management</h2>

            <!-- Expected client version info -->
            <div id="expected-version-card" style="display:flex; gap:16px; margin-bottom:24px; align-items:center; background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:16px 24px; flex-wrap:wrap;">
                <div>
                    <div style="font-size:12px; color:#8f98a0; margin-bottom:4px;">Expected Client Version</div>
                    <div id="expected-version" style="font-size:28px; font-weight:700; color:#66c0f4;">—</div>
                </div>
                <div style="border-left:1px solid #2a475e; padding-left:16px;">
                    <div style="font-size:12px; color:#8f98a0; margin-bottom:4px;">Fleet Status</div>
                    <div id="fleet-update-status" style="font-size:14px; color:#c7d5e0;">Loading...</div>
                </div>
                <div style="margin-left:auto;">
                    <button id="btn-client-check" class="diag-btn" style="padding:8px 16px;">Check for Client Update</button>
                </div>
            </div>

            <!-- Fleet version distribution -->
            <h2 class="section-title">Fleet Versions</h2>
            <div class="stats-row" id="fleet-versions-row" style="margin-bottom: 24px;"></div>

            <!-- Uploaded packages -->
            <h2 class="section-title">Uploaded Packages</h2>
            <table class="client-table">
                <thead><tr><th>Version</th><th>File Size</th><th>SHA-256</th><th>Uploaded</th><th>Actions</th></tr></thead>
                <tbody id="updates-table-body"></tbody>
            </table>
        </div>

        <!-- Deploy page -->
        <div class="page" id="page-deploy">
            <h2 class="section-title">Deploy Scripts &amp; Files</h2>
            <div class="deploy-tabs" id="deploy-tabs">
                <button class="diag-btn active" id="deploy-tab-new" data-tab="new">New Deployment</button>
                <button class="diag-btn" id="deploy-tab-history" data-tab="history">Deployment History</button>
                <button class="diag-btn" id="deploy-tab-templates" data-tab="templates">Templates</button>
            </div>

            <!-- New Deployment Form -->
            <div id="deploy-new" class="client-form">
                <!-- General + Script/File panels side by side -->
                <div class="deploy-form-row">
                    <!-- Name & Type -->
                    <div class="deploy-section">
                        <div class="deploy-section-title">General</div>
                        <div style="display:flex; gap:8px; align-items:center; margin-bottom:12px;">
                            <select id="deploy-template-select" style="flex:1; padding:6px 10px; font-size:13px; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; border-radius:6px;">
                                <option value="">Load from template...</option>
                            </select>
                            <button class="diag-btn" id="btn-save-deploy-template" style="font-size:12px; padding:5px 12px; white-space:nowrap;">Save as Template</button>
                        </div>
                        <label>Deployment Name</label>
                        <input type="text" id="deploy-name" placeholder="e.g. Install Chrome, Run cleanup script" style="width:100%;">

                        <label>Type</label>
                        <div class="deploy-radio-group" id="deploy-type-group">
                            <label><input type="radio" name="deploy-type" value="script" checked> Script</label>
                            <label><input type="radio" name="deploy-type" value="installer"> File</label>
                        </div>
                        <div style="display:flex; align-items:center; gap:12px; margin-top:4px;">
                            <div>
                                <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Timeout</label>
                                <input type="number" id="deploy-timeout" value="300" min="30" max="600" class="deploy-input-sm">
                            </div>
                            <span style="font-size:11px; color:#8f98a0; margin-top:18px;">seconds (30-600)</span>
                        </div>
                    </div>

                    <!-- Script panel -->
                    <div id="deploy-script-panel" class="deploy-section">
                        <div class="deploy-section-title">Script Configuration</div>
                        <label>Library Script</label>
                        <select id="deploy-script-select" class="deploy-select">
                            <option value="">-- Ad-hoc script --</option>
                        </select>
                        <label>Script Content</label>
                        <textarea id="deploy-script-content" class="deploy-textarea" placeholder="Enter PowerShell script..."></textarea>
                        <select id="deploy-script-os" style="margin-top:6px; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:6px 8px; border-radius:4px; font-size:12px;">
                            <option value="windows">Windows</option>
                            <option value="windows-server">Windows Server</option>
                            <option value="macos">macOS</option>
                            <option value="linux">Linux</option>
                        </select>
                        <button class="diag-btn" id="btn-generate-script-deploy" style="margin-top:6px; font-size:12px;">&#10022; Generate with AI</button>
                        <div class="deploy-checkbox-box">
                            <label class="toggle-label">
                                <span class="toggle-switch"><input type="checkbox" id="deploy-elevation"><span class="toggle-track"></span></span> Requires elevation
                            </label>
                        </div>
                    </div>

                    <!-- File panel -->
                    <div id="deploy-installer-panel" class="deploy-section" style="display:none;">
                        <div class="deploy-section-title">File Configuration</div>
                        <label>File (.exe, .msi, .ps1, .bat — max 50MB)</label>
                        <input type="file" id="deploy-installer-file" accept=".exe,.msi,.ps1,.bat" style="margin:8px 0;">
                        <div id="deploy-installer-info" class="deploy-file-info"></div>
                        <label>Silent Arguments</label>
                        <input type="text" id="deploy-silent-args" placeholder="e.g. /S or /qn ALLUSERS=1" style="width:100%;">
                    </div>
                </div>

                <!-- Target Devices -->
                <div class="deploy-section">
                    <div class="deploy-section-title">Target Devices</div>
                    <div style="display:flex; gap:8px; align-items:center; margin-bottom:10px; flex-wrap:wrap;">
                        <div class="deploy-btn-row" style="margin:0;">
                            <button class="diag-btn" id="btn-deploy-select-online">Select All Online</button>
                            <button class="diag-btn" id="btn-deploy-select-all">Select All</button>
                            <button class="diag-btn" id="btn-deploy-select-none">Clear</button>
                        </div>
                        <span style="color:#2a475e; margin:0 2px;">|</span>
                        <select id="deploy-filter-client" class="deploy-input-sm" style="width:150px;">
                            <option value="">All Clients</option>
                        </select>
                        <input type="text" id="deploy-filter-search" placeholder="Search hostname..." class="deploy-input-sm" style="width:160px;">
                        <span id="deploy-selected-count" style="font-size:12px; color:#66c0f4; margin-left:auto;">0 selected</span>
                    </div>
                    <div id="deploy-device-list" class="deploy-device-grid"></div>
                </div>

                <!-- Schedule -->
                <div class="deploy-section">
                    <div class="deploy-section-title">Schedule</div>
                    <div class="deploy-radio-group" id="deploy-schedule-group">
                        <label><input type="radio" name="deploy-schedule" value="now" checked> Run immediately</label>
                        <label><input type="radio" name="deploy-schedule" value="later"> Schedule for later</label>
                    </div>
                    <div id="deploy-schedule-picker" style="display:none;">
                        <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
                            <div>
                                <label style="font-size:11px; color:#8f98a0; display:block; margin-bottom:4px;">Date</label>
                                <input type="date" id="deploy-schedule-date" class="deploy-schedule-input">
                            </div>
                            <div>
                                <label style="font-size:11px; color:#8f98a0; display:block; margin-bottom:4px;">Time</label>
                                <input type="time" id="deploy-schedule-time-input" class="deploy-schedule-input">
                            </div>
                            <div id="deploy-schedule-preview" style="font-size:12px; color:#66c0f4; margin-top:16px;"></div>
                        </div>
                    </div>
                </div>

                <div style="margin-top:8px; padding-top:16px; border-top:1px solid #2a475e;">
                    <button class="deploy-submit" id="btn-deploy-submit">Deploy</button>
                </div>
            </div>

            <!-- Deployment History -->
            <div id="deploy-history" style="display:none;">
                <div id="deploy-history-list">
                    <div style="color:#8f98a0; text-align:center; padding:24px;">Loading...</div>
                </div>
            </div>

            <!-- Templates -->
            <div id="deploy-templates" style="display:none;">
                <div id="deploy-templates-list">
                    <div style="color:#8f98a0; text-align:center; padding:24px;">Loading...</div>
                </div>
            </div>
        </div>

        <!-- Wishlist page -->
        <div class="page" id="page-wishlist">
            <h2 class="section-title">Feature Wishlist</h2>
            <p style="font-size:13px; color:#8f98a0; margin-bottom:20px;">Capability gaps logged by the AI when it can't fulfill user requests.</p>

            <!-- Stats bar -->
            <div class="wish-stats-bar">
                <div class="wish-stat">
                    <div class="ws-value" id="wish-stat-total">—</div>
                    <div class="ws-label">Total Wishes</div>
                </div>
                <div class="wish-stat">
                    <div class="ws-value" id="wish-stat-top-cat">—</div>
                    <div class="ws-label">Top Category</div>
                </div>
                <div class="wish-stat">
                    <div class="ws-value" id="wish-stat-top-votes">—</div>
                    <div class="ws-label">Most Voted</div>
                </div>
            </div>

            <!-- Filters -->
            <div class="wish-filter-row">
                <select id="wish-filter-status">
                    <option value="">All Statuses</option>
                    <option value="approved">Approved</option>
                    <option value="implemented">Implemented</option>
                    <option value="pending" selected>Pending</option>
                    <option value="rejected">Rejected</option>
                </select>
                <select id="wish-filter-category">
                    <option value="">All Categories</option>
                    <option value="account">Account</option>
                    <option value="automation">Automation</option>
                    <option value="hardware">Hardware</option>
                    <option value="network">Network</option>
                    <option value="other">Other</option>
                    <option value="security">Security</option>
                    <option value="software">Software</option>
                </select>
                <button class="diag-btn" id="btn-refresh-wishes">Refresh</button>
            </div>

            <!-- Wishes table -->
            <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; overflow:hidden;">
                <table class="wish-table">
                    <thead>
                        <tr>
                            <th style="width:52px;">Votes</th>
                            <th style="width:110px;">Category</th>
                            <th>AI Need</th>
                            <th>User Request</th>
                            <th>Device</th>
                            <th style="width:100px;">Status</th>
                            <th style="width:190px;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="wish-tbody">
                        <tr><td colspan="7" style="text-align:center; padding:32px; color:#8f98a0;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Script Library page -->
        <div class="page" id="page-scripts">
            <h2 class="section-title">Script Library</h2>
            <p style="font-size:13px; color:#8f98a0; margin-bottom:20px;">Manage reusable PowerShell scripts for remote execution on devices.</p>

            <!-- Create/Edit form -->
            <div class="client-form" id="script-form" style="margin-bottom:24px;">
                <h3 id="script-form-title" style="margin-bottom:12px; color:#c7d5e0;">New Script</h3>
                <input type="hidden" id="script-edit-id" value="">
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:12px;">
                    <div>
                        <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Name *</label>
                        <input type="text" id="script-name" placeholder="e.g. Clear Print Queue" style="width:100%;">
                    </div>
                    <div>
                        <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Category</label>
                        <select id="script-category" style="width:100%;">
                            <option value="diagnostics">Diagnostics</option>
                            <option value="general">General</option>
                            <option value="info">Info</option>
                            <option value="maintenance">Maintenance</option>
                            <option value="network">Network</option>
                            <option value="remediation">Remediation</option>
                            <option value="security">Security</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">OS</label>
                        <select id="script-os" style="width:100%;">
                            <option value="windows">Windows</option>
                            <option value="windows-server">Windows Server</option>
                            <option value="macos">macOS</option>
                            <option value="linux">Linux</option>
                        </select>
                    </div>
                </div>
                <div style="margin-bottom:12px;">
                    <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Description</label>
                    <input type="text" id="script-description" placeholder="What does this script do?" style="width:100%;">
                </div>
                <div style="margin-bottom:12px;">
                    <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Script Content (PowerShell) *</label>
                    <textarea id="script-content" rows="10" style="width:100%; font-family:monospace; font-size:13px; background:#0f1923; color:#c7d5e0; border:1px solid #2a475e; border-radius:4px; padding:10px; resize:vertical;" placeholder="Write-Host 'Hello World'"></textarea>
                    <button class="diag-btn" id="btn-generate-script-library" style="margin-top:6px; font-size:12px;">&#10022; Generate with AI</button>
                </div>
                <div style="display:flex; gap:16px; align-items:center; margin-bottom:12px;">
                    <label class="toggle-label">
                        <span class="toggle-switch"><input type="checkbox" id="script-elevation"><span class="toggle-track"></span></span> Requires Admin Elevation
                    </label>
                    <div style="display:flex; align-items:center; gap:6px;">
                        <label style="font-size:12px; color:#8f98a0;">Timeout (sec):</label>
                        <input type="number" id="script-timeout" value="60" min="5" max="300" style="width:70px;">
                    </div>
                </div>
                <div style="margin-bottom:12px;">
                    <label class="toggle-label">
                        <span class="toggle-switch"><input type="checkbox" id="script-ai-tool"><span class="toggle-track"></span></span>
                        AI Tool
                        <span class="toggle-desc">— AI assistant can suggest this script during chat</span>
                    </label>
                </div>
                <div style="display:flex; gap:8px;">
                    <button class="diag-btn" id="btn-save-script" style="background:#1a3a5c; color:#66c0f4; border-color:#66c0f4;">Save Script</button>
                    <button class="diag-btn" id="btn-cancel-script" style="display:none;">Cancel</button>
                </div>
            </div>

            <!-- Filter bar -->
            <div style="display:flex; gap:8px; align-items:center; margin-bottom:12px;">
                <select id="script-filter-category" style="padding:6px 10px; background:#0f1923; border:1px solid #2a475e; border-radius:4px; color:#c7d5e0;">
                    <option value="">All Categories</option>
                    <option value="diagnostics">Diagnostics</option>
                    <option value="general">General</option>
                    <option value="info">Info</option>
                    <option value="maintenance">Maintenance</option>
                    <option value="network">Network</option>
                    <option value="remediation">Remediation</option>
                    <option value="security">Security</option>
                </select>
                <button class="diag-btn" id="btn-refresh-scripts">Refresh</button>
                <span id="script-count" style="font-size:12px; color:#8f98a0; margin-left:8px;"></span>
            </div>

            <!-- Scripts table -->
            <div style="background:#1b2838; border:1px solid #2a475e; border-radius:8px; overflow:hidden;">
                <table style="width:100%; border-collapse:collapse;">
                    <thead>
                        <tr style="border-bottom:1px solid #2a475e; text-align:left;">
                            <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">Name</th>
                            <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">Category</th>
                            <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">OS</th>
                            <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">Description</th>
                            <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">Elevation</th>
                            <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">Timeout</th>
                            <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">AI Tool</th>
                            <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="scripts-table-body">
                        <tr><td colspan="8" style="text-align:center; padding:32px; color:#8f98a0;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
            <!-- Scripting Integration Guide -->
            <div style="margin-top:24px; background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:16px;">
                <h3 style="color:#c7d5e0; margin:0 0 12px 0;">Scripting Integration Guide</h3>
                <details style="margin-bottom:12px;">
                    <summary style="cursor:pointer; color:#66c0f4; font-size:13px;">Auto-populate Device Custom Fields</summary>
                    <div style="padding:8px 0; font-size:13px; color:#c7d5e0;">
                        <p style="margin:0 0 8px;">Scripts can set custom fields on the device they run on by printing a special marker line:</p>
                        <code style="display:block; background:#0f1923; padding:8px 12px; border-radius:4px; font-size:12px; color:#66c0f4; margin-bottom:8px;">POCKET_IT_FIELDS:{"Department":"Engineering","Asset Tag":"A1234","Warranty":"2027-03"}</code>
                        <p style="margin:0; font-size:12px; color:#8f98a0;">The JSON is parsed and upserted as device custom fields. Multiple marker lines are supported. Source shows as "script" in field cards on the device page.</p>
                    </div>
                </details>
                <details style="margin-bottom:12px;">
                    <summary style="cursor:pointer; color:#66c0f4; font-size:13px;">Auto-populate Client Custom Fields</summary>
                    <div style="padding:8px 0; font-size:13px; color:#c7d5e0;">
                        <p style="margin:0 0 8px;">Scripts can also set custom fields on the client that owns the device:</p>
                        <code style="display:block; background:#0f1923; padding:8px 12px; border-radius:4px; font-size:12px; color:#66c0f4; margin-bottom:8px;">POCKET_IT_CLIENT_FIELDS:{"SLA Tier":"Gold","Contract End":"2026-12","Account Manager":"Jane Doe"}</code>
                        <p style="margin:0; font-size:12px; color:#8f98a0;">Fields are upserted on the device's parent client. Source shows as "script" in field cards on the Client Management page.</p>
                    </div>
                </details>
                <details>
                    <summary style="cursor:pointer; color:#66c0f4; font-size:13px;">Example: Collect system info into both device and client fields</summary>
                    <div style="padding:8px 0; font-size:13px; color:#c7d5e0;">
<pre style="background:#0f1923; padding:12px; border-radius:4px; font-size:12px; color:#c7d5e0; overflow-x:auto; margin:0;">
# Collect device-level info
$os = (Get-CimInstance Win32_OperatingSystem).Caption
$serial = (Get-CimInstance Win32_BIOS).SerialNumber
Write-Host "POCKET_IT_FIELDS:{`"OS`":`"$os`",`"Serial`":`"$serial`"}"

# Collect client-level info (e.g. domain/org)
$domain = (Get-CimInstance Win32_ComputerSystem).Domain
Write-Host "POCKET_IT_CLIENT_FIELDS:{`"Domain`":`"$domain`"}"
</pre>
                    </div>
                </details>
            </div>
        </div>

        <!-- Settings page -->
        <div class="page" id="page-settings">
            <h2 class="section-title">Server Settings</h2>

            <!-- Server Configuration -->
            <div class="client-form" style="margin-bottom: 24px;">
                <h3 style="margin-bottom: 12px; color: #c7d5e0;">Server Configuration</h3>
                <label>Public URL <span style="font-size:11px;color:#8f98a0;">(how clients reach this server)</span></label>
                <input type="text" id="setting-server-url" placeholder="e.g. http://10.0.0.5:9100" style="max-width:400px;">
            </div>

            <!-- AI/LLM Configuration -->
            <div class="client-form" style="margin-bottom: 24px;">
                <h3 style="margin-bottom: 12px; color: #c7d5e0;">AI / LLM Configuration</h3>

                <div style="display:flex; align-items:center; gap:12px; margin-bottom:16px; padding:12px; background:#0f1923; border:1px solid #2a475e; border-radius:6px;">
                    <label style="margin:0; color:#c7d5e0; font-weight:600;">AI Assistant</label>
                    <label class="toggle-label"><span class="toggle-switch"><input type="checkbox" id="setting-ai-enabled" checked><span class="toggle-track"></span></span></label>
                    <span style="font-size:12px; color:#8f98a0;">When off, all devices get "live agent" mode — no AI responses</span>
                </div>

                <label>Provider</label>
                <select id="setting-llm-provider" style="max-width:250px;padding:6px 10px;background:#1b2838;color:#c7d5e0;border:1px solid #2a475e;border-radius:4px;">
                    <option value="anthropic">Anthropic</option>
                    <option value="claude-cli">Claude CLI</option>
                    <option value="gemini">Google Gemini</option>
                    <option value="ollama">Ollama (Local)</option>
                    <option value="openai">OpenAI</option>
                </select>

                <!-- Ollama settings -->
                <div id="llm-ollama-settings" style="margin-top:12px;">
                    <label>Ollama URL</label>
                    <input type="text" id="setting-ollama-url" placeholder="http://localhost:11434" style="max-width:400px;">
                    <label>Ollama Model</label>
                    <input type="text" id="setting-ollama-model" placeholder="llama3.2" style="max-width:250px;">
                </div>

                <!-- OpenAI settings -->
                <div id="llm-openai-settings" style="margin-top:12px;display:none;">
                    <label>API Key</label>
                    <input type="password" id="setting-openai-key" placeholder="sk-..." style="max-width:400px;">
                    <label>Model</label>
                    <input type="text" id="setting-openai-model" placeholder="gpt-4o-mini" style="max-width:250px;">
                </div>

                <!-- Anthropic settings -->
                <div id="llm-anthropic-settings" style="margin-top:12px;display:none;">
                    <label>API Key</label>
                    <input type="password" id="setting-anthropic-key" placeholder="sk-ant-..." style="max-width:400px;">
                    <label>Model</label>
                    <input type="text" id="setting-anthropic-model" placeholder="claude-sonnet-4-5-20250929" style="max-width:250px;">
                </div>

                <!-- Claude CLI settings -->
                <div id="llm-claude-cli-settings" style="margin-top:12px;display:none;">
                    <label>Model <span style="font-size:11px;color:#8f98a0;">(leave empty for default)</span></label>
                    <input type="text" id="setting-claude-cli-model" placeholder="(default)" style="max-width:250px;">
                </div>

                <!-- Gemini settings -->
                <div id="llm-gemini-settings" style="margin-top:12px;display:none;">
                    <label>Gemini API Key</label>
                    <input type="password" id="setting-gemini-key" placeholder="AIza..." style="max-width:400px;">
                    <label>Gemini Model</label>
                    <input type="text" id="setting-gemini-model" placeholder="gemini-2.5-flash-lite" style="max-width:250px;">
                </div>

                <div style="display:flex;align-items:center;gap:12px;margin-top:16px;">
                    <button class="diag-btn" id="test-llm-btn-inline" style="background:#1a3a5c;">Test Connection</button>
                    <span id="test-llm-status" style="font-size:12px;color:#8f98a0;"></span>
                </div>

                <div style="margin-top:16px;">
                    <label style="font-size:13px; color:#8f98a0;">Response Timeout</label>
                    <div style="display:flex; align-items:center; gap:8px; margin-top:4px;">
                        <input type="number" id="setting-llm-timeout" value="120" min="15" max="600" style="width:80px;padding:6px 10px;background:#0f1923;border:1px solid #2a475e;color:#c7d5e0;border-radius:4px;font-size:13px;">
                        <span style="font-size:12px; color:#8f98a0;">seconds (15-600). How long to wait for LLM response before timing out.</span>
                    </div>
                </div>
            </div>

            <!-- System Info (read-only) -->
            <div class="client-form" style="margin-bottom: 24px;">
                <h3 style="margin-bottom: 12px; color: #c7d5e0;">System Information</h3>
                <div style="display:grid;grid-template-columns:150px 1fr;gap:8px;font-size:13px;">
                    <span style="color:#8f98a0;">Server Port:</span>
                    <span id="sys-info-port" style="color:#c7d5e0;">-</span>
                    <span style="color:#8f98a0;">Database Size:</span>
                    <span id="sys-info-db-size" style="color:#c7d5e0;">-</span>
                    <span style="color:#8f98a0;">Active Provider:</span>
                    <span id="sys-info-provider" style="color:#c7d5e0;">-</span>
                    <span style="color:#8f98a0;">Online Devices:</span>
                    <span id="sys-info-devices" style="color:#c7d5e0;">-</span>
                </div>
            </div>

            <!-- Server Update -->
            <div class="client-form" style="margin-bottom: 24px;" id="server-update-card">
                <h3 style="margin-bottom: 12px; color: #c7d5e0;">Server Update</h3>
                <div style="display:grid;grid-template-columns:150px 1fr;gap:8px;font-size:13px;margin-bottom:16px;">
                    <span style="color:#8f98a0;">Server version:</span>
                    <span id="srv-update-version" style="color:#c7d5e0;">—</span>
                    <span style="color:#8f98a0;">Current commit:</span>
                    <span id="srv-update-commit" style="color:#c7d5e0;">—</span>
                    <span style="color:#8f98a0;">Last checked:</span>
                    <span id="srv-update-checked" style="color:#8f98a0;">Never</span>
                </div>
                <div style="margin-bottom:12px;">
                    <button class="diag-btn" id="btn-check-update" style="padding:8px 18px;">Check for Updates</button>
                </div>
                <div id="srv-update-result" style="display:none;margin-bottom:12px;padding:12px;background:#0f1923;border:1px solid #2a475e;border-radius:6px;font-size:13px;">
                    <div id="srv-update-status" style="color:#66c0f4;margin-bottom:8px;font-weight:bold;"></div>
                    <div id="srv-update-details" style="color:#c7d5e0;"></div>
                    <div id="srv-update-commits" style="color:#8f98a0;margin-top:8px;font-size:12px;max-height:120px;overflow-y:auto;"></div>
                    <div style="margin-top:12px;display:none;" id="srv-update-apply-wrap">
                        <button class="diag-btn" id="btn-apply-update" style="padding:8px 18px;background:#b45309;border-color:#d97706;">Update Server</button>
                        <span style="font-size:11px;color:#fbbf24;margin-left:8px;">Server will restart</span>
                    </div>
                </div>
                <div id="srv-update-progress" style="display:none;padding:12px;background:#0f1923;border:1px solid #2a475e;border-radius:6px;font-size:13px;">
                    <div id="srv-update-progress-steps"></div>
                </div>
            </div>

            <!-- Save button -->
            <div style="display:flex;align-items:center;gap:12px;">
                <button class="diag-btn" id="btn-save-settings" style="padding:10px 24px;font-size:14px;">Save Settings</button>
                <button id="test-llm-btn" style="background:#2563eb; color:white; border:none; border-radius:6px; padding:8px 18px; cursor:pointer; font-size:14px; margin-left:10px;">Test LLM Connection</button>
                <span id="save-settings-status" style="font-size:12px;color:#8f98a0;"></span>
            </div>
            <div id="llm-test-result" style="display:none; margin-top:8px; padding:8px 12px; border-radius:6px; background:#1a1a2e; font-size:13px;"></div>
        </div>

        <div class="page" id="page-users">
            <h2 style="margin-bottom:16px;">IT Users</h2>
            <div style="display:flex; gap:12px; margin-bottom:16px; align-items:flex-end; flex-wrap:wrap;">
                <div>
                    <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Username *</label>
                    <input type="text" id="user-new-username" placeholder="Username" style="width:160px;">
                </div>
                <div>
                    <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Display Name</label>
                    <input type="text" id="user-new-displayname" placeholder="Display Name" style="width:180px;">
                </div>
                <div>
                    <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Password *</label>
                    <input type="password" id="user-new-password" placeholder="Password" style="width:160px;">
                </div>
                <div>
                    <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Role</label>
                    <select id="user-new-role">
                        <option value="viewer">Viewer</option>
                        <option value="technician" selected>Technician</option>
                        <option value="admin">Admin</option>
                        <option value="superadmin">Superadmin</option>
                    </select>
                </div>
                <button class="diag-btn" id="btn-create-user" style="height:36px;">Add User</button>
            </div>
            <div id="user-message" style="display:none; padding:8px 12px; border-radius:6px; margin-bottom:12px; font-size:13px;"></div>
            <table style="width:100%; border-collapse:collapse;">
                <thead>
                    <tr style="border-bottom:1px solid #2a475e; text-align:left;">
                        <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">Username</th>
                        <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">Display Name</th>
                        <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">Role</th>
                        <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">2FA</th>
                        <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">Last Login</th>
                        <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">Created</th>
                        <th style="padding:8px 12px; color:#8f98a0; font-size:12px;">Actions</th>
                    </tr>
                </thead>
                <tbody id="users-table-body"></tbody>
            </table>
        </div>

        <!-- Passwords page -->
        <div class="page" id="page-passwords">
          <div style="display:flex; align-items:center; gap:12px; margin-bottom:16px; flex-wrap:wrap;">
            <h2 class="section-title" style="margin:0;">Password Database</h2>
            <select id="passwords-client-filter" style="background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:6px 10px; border-radius:6px; font-size:13px;">
              <option value="">All Clients</option>
            </select>
            <input type="text" id="passwords-search" placeholder="Search name, username..." style="flex:1; max-width:300px; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:6px 10px; border-radius:6px; font-size:13px;" />
            <button class="diag-btn" id="btn-add-password">+ Add Password</button>
          </div>

          <!-- Inline add/edit form (hidden by default) -->
          <div id="password-form-panel" style="display:none; background:#1b2838; border:1px solid #2a475e; border-radius:8px; padding:16px; margin-bottom:16px;">
            <h3 style="margin:0 0 12px; font-size:15px; color:#c7d5e0;" id="password-form-title">Add Password</h3>
            <input type="hidden" id="password-form-id" value="" />
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
              <div>
                <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Name *</label>
                <input type="text" id="pf-name" placeholder="e.g. Router Admin" style="width:100%; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:6px 10px; border-radius:6px; font-size:13px; box-sizing:border-box;" />
              </div>
              <div>
                <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Client *</label>
                <select id="pf-client" style="width:100%; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:6px 10px; border-radius:6px; font-size:13px;">
                  <option value="">Select client...</option>
                </select>
              </div>
              <div>
                <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Device (optional)</label>
                <select id="pf-device" style="width:100%; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:6px 10px; border-radius:6px; font-size:13px;">
                  <option value="">No device</option>
                </select>
              </div>
              <div>
                <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Username</label>
                <input type="text" id="pf-username" placeholder="Username" style="width:100%; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:6px 10px; border-radius:6px; font-size:13px; box-sizing:border-box;" />
              </div>
              <div>
                <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Password</label>
                <input type="password" id="pf-password" placeholder="Leave blank to keep existing" style="width:100%; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:6px 10px; border-radius:6px; font-size:13px; box-sizing:border-box;" />
              </div>
              <div>
                <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">OTP Secret (optional)</label>
                <input type="text" id="pf-otp" placeholder="Base32 OTP secret" style="width:100%; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:6px 10px; border-radius:6px; font-size:13px; box-sizing:border-box;" />
              </div>
              <div style="grid-column:1/-1;">
                <label style="font-size:12px; color:#8f98a0; display:block; margin-bottom:4px;">Notes</label>
                <textarea id="pf-notes" rows="3" placeholder="Optional notes..." style="width:100%; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:6px 10px; border-radius:6px; font-size:13px; box-sizing:border-box; resize:vertical;"></textarea>
              </div>
            </div>
            <div style="margin-top:12px; display:flex; gap:8px;">
              <button class="diag-btn" id="btn-pw-save">Save</button>
              <button class="diag-btn" style="background:#2a475e;" id="btn-pw-cancel">Cancel</button>
            </div>
          </div>

          <!-- Passwords table -->
          <div id="passwords-table-container">
            <table style="width:100%; border-collapse:collapse; font-size:13px;">
              <thead>
                <tr style="color:#8f98a0; border-bottom:1px solid #2a475e;">
                  <th style="text-align:left; padding:8px 10px; font-weight:500;">Name</th>
                  <th style="text-align:left; padding:8px 10px; font-weight:500;">Client</th>
                  <th style="text-align:left; padding:8px 10px; font-weight:500;">Device</th>
                  <th style="text-align:left; padding:8px 10px; font-weight:500;">Username</th>
                  <th style="text-align:left; padding:8px 10px; font-weight:500;">Password</th>
                  <th style="text-align:left; padding:8px 10px; font-weight:500;">OTP</th>
                  <th style="text-align:left; padding:8px 10px; font-weight:500;">Actions</th>
                </tr>
              </thead>
              <tbody id="passwords-table-body">
                <tr><td colspan="7" style="padding:20px; text-align:center; color:#8f98a0;">Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- My Account page -->
        <div class="page" id="page-account">
            <h2 style="margin-bottom:20px;">My Account</h2>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; max-width:900px;">
                <!-- Profile Section -->
                <div style="background:var(--bg-panel); border:1px solid var(--border); border-radius:8px; padding:20px;">
                    <h3 style="font-size:14px; color:var(--text-muted); margin-bottom:16px; text-transform:uppercase; letter-spacing:1px;">Profile</h3>
                    <div style="margin-bottom:12px;">
                        <label style="font-size:12px; color:var(--text-muted); display:block; margin-bottom:4px;">Username</label>
                        <div id="account-username" style="font-weight:600; color:var(--text-main);"></div>
                    </div>
                    <div style="margin-bottom:12px;">
                        <label style="font-size:12px; color:var(--text-muted); display:block; margin-bottom:4px;">Display Name</label>
                        <input type="text" id="account-display-name" style="width:100%;" />
                    </div>
                    <div style="margin-bottom:12px;">
                        <label style="font-size:12px; color:var(--text-muted); display:block; margin-bottom:4px;">Role</label>
                        <div id="account-role" style="display:inline-block; background:color-mix(in srgb, var(--accent) 20%, transparent); color:var(--accent); padding:2px 10px; border-radius:12px; font-size:12px; font-weight:600;"></div>
                    </div>
                    <div style="margin-bottom:16px;">
                        <label style="font-size:12px; color:var(--text-muted); display:block; margin-bottom:4px;">Last Login</label>
                        <div id="account-last-login" style="font-size:13px; color:var(--text-muted);"></div>
                    </div>
                    <div id="account-profile-msg" style="display:none; padding:6px 10px; border-radius:6px; font-size:12px; margin-bottom:8px;"></div>
                    <button class="diag-btn" id="btn-save-profile" style="width:100%;">Save Profile</button>
                </div>

                <!-- Password Section -->
                <div style="background:var(--bg-panel); border:1px solid var(--border); border-radius:8px; padding:20px;">
                    <h3 style="font-size:14px; color:var(--text-muted); margin-bottom:16px; text-transform:uppercase; letter-spacing:1px;">Change Password</h3>
                    <div style="margin-bottom:12px;">
                        <label style="font-size:12px; color:var(--text-muted); display:block; margin-bottom:4px;">Current Password</label>
                        <input type="password" id="account-current-pw" style="width:100%;" />
                    </div>
                    <div style="margin-bottom:12px;">
                        <label style="font-size:12px; color:var(--text-muted); display:block; margin-bottom:4px;">New Password</label>
                        <input type="password" id="account-new-pw" style="width:100%;" />
                    </div>
                    <div style="margin-bottom:16px;">
                        <label style="font-size:12px; color:var(--text-muted); display:block; margin-bottom:4px;">Confirm New Password</label>
                        <input type="password" id="account-confirm-pw" style="width:100%;" />
                    </div>
                    <div id="account-pw-msg" style="display:none; padding:6px 10px; border-radius:6px; font-size:12px; margin-bottom:8px;"></div>
                    <button class="diag-btn" id="btn-change-password" style="width:100%;">Change Password</button>
                </div>

                <!-- Two-Factor Authentication Section -->
                <div style="background:var(--bg-panel); border:1px solid var(--border); border-radius:8px; padding:20px;">
                    <h3 style="font-size:14px; color:var(--text-muted); margin-bottom:16px; text-transform:uppercase; letter-spacing:1px;">Two-Factor Authentication</h3>
                    <div style="margin-bottom:12px;">
                        <label style="font-size:12px; color:var(--text-muted); display:block; margin-bottom:4px;">Status</label>
                        <span id="account-2fa-status" style="font-weight:600;"></span>
                    </div>
                    <div style="margin-bottom:16px;">
                        <label style="font-size:12px; color:var(--text-muted); display:block; margin-bottom:4px;">Backup Codes</label>
                        <span id="account-backup-count" style="font-size:13px;"></span>
                    </div>
                    <div id="account-2fa-msg" style="display:none; padding:6px 10px; border-radius:6px; font-size:12px; margin-bottom:8px;"></div>
                    <div id="account-backup-display" style="display:none; background:var(--bg-deep); border:1px solid var(--border); border-radius:6px; padding:12px; margin-bottom:12px;">
                        <p style="font-size:12px; color:var(--warning); margin-bottom:8px;">Save these codes — each can only be used once:</p>
                        <div id="account-backup-codes" style="display:grid; grid-template-columns:1fr 1fr; gap:4px; font-family:monospace; font-size:13px; color:var(--accent);"></div>
                        <button class="diag-btn" id="btn-copy-account-backup" style="width:100%; margin-top:8px; font-size:11px;">Copy All</button>
                    </div>
                    <div style="display:flex; gap:8px;">
                        <button class="diag-btn" id="btn-regen-backup" style="flex:1;">Regenerate Backup Codes</button>
                        <button class="diag-btn" id="btn-reset-own-2fa" style="flex:1; background:color-mix(in srgb, var(--error) 20%, transparent); border-color:var(--error); color:var(--error);">Reset 2FA</button>
                    </div>
                </div>

                <!-- Preferences Section -->
                <div style="background:var(--bg-panel); border:1px solid var(--border); border-radius:8px; padding:20px;">
                    <h3 style="font-size:14px; color:var(--text-muted); margin-bottom:16px; text-transform:uppercase; letter-spacing:1px;">Preferences</h3>
                    <div style="margin-bottom:12px;">
                        <label style="font-size:12px; color:var(--text-muted); display:block; margin-bottom:4px;">Theme</label>
                        <select id="pref-theme">
                            <option value="dark">Dark</option>
                            <option value="light">Light</option>
                        </select>
                    </div>
                    <div style="margin-bottom:12px;">
                        <label style="font-size:12px; color:var(--text-muted); display:block; margin-bottom:4px;">Default Page</label>
                        <select id="pref-default-page">
                            <option value="alerts">Alerts</option>
                            <option value="deploy">Deploy</option>
                            <option value="fleet">Fleet</option>
                            <option value="reports">Reports</option>
                            <option value="tickets">Tickets</option>
                        </select>
                    </div>
                    <div style="margin-bottom:12px;">
                        <label style="font-size:12px; color:var(--text-muted); display:block; margin-bottom:4px;">Items Per Page</label>
                        <select id="pref-items-per-page">
                            <option value="10">10</option>
                            <option value="25" selected>25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                    </div>
                    <div style="margin-bottom:16px;">
                        <label style="font-size:12px; color:var(--text-muted); display:block; margin-bottom:4px;">Date Format</label>
                        <select id="pref-date-format">
                            <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                            <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                            <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                        </select>
                    </div>
                    <div id="account-pref-msg" style="display:none; padding:6px 10px; border-radius:6px; font-size:12px; margin-bottom:8px;"></div>
                    <button class="diag-btn" id="btn-save-prefs" style="width:100%;">Save Preferences</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@xterm/addon-fit@0.10.0/lib/addon-fit.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="dashboard.js"></script>
<div id="toast-container"></div>
    <!-- Ticket detail panel (global overlay) -->
    <div class="detail-panel" id="ticket-detail">
        <div class="panel-header">
            <h3 id="ticket-detail-title">Ticket</h3>
            <button class="close-btn" id="btn-close-ticket">Close</button>
        </div>
        <div id="ticket-detail-info" style="font-size:13px; color:#8f98a0; margin-bottom:16px;"></div>
        <div id="ticket-detail-description" style="background:#0f1923; border:1px solid #2a475e; border-radius:8px; padding:12px; margin-bottom:16px; font-size:13px; line-height:1.5;"></div>
        <div style="display:flex; gap:12px; margin-bottom:16px;">
            <div>
                <label style="font-size:12px; color:#8f98a0;">Status</label>
                <select id="ticket-status-select" style="display:block; margin-top:4px; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:6px 10px; border-radius:4px; font-size:13px;">
                    <option value="open">Open</option>
                    <option value="in_progress">In Progress</option>
                    <option value="resolved">Resolved</option>
                    <option value="closed">Closed</option>
                </select>
            </div>
            <div>
                <label style="font-size:12px; color:#8f98a0;">Priority</label>
                <select id="ticket-priority-select" style="display:block; margin-top:4px; background:#0f1923; border:1px solid #2a475e; color:#c7d5e0; padding:6px 10px; border-radius:4px; font-size:13px;">
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                    <option value="critical">Critical</option>
                </select>
            </div>
        </div>
        <h4 style="margin:16px 0 8px; color:#c7d5e0;">Comments</h4>
        <div id="ticket-comments" style="margin-bottom:12px;"></div>
        <div class="chat-input-row">
            <input type="text" id="ticket-comment-input" placeholder="Add a comment..." />
            <button id="btn-add-ticket-comment">Comment</button>
        </div>
    </div>
</body>
</html>
